1. **You**: bạn thấy code của tôi chứ
2. **ChatGPT**: Tất nhiên, tôi sẽ rất vui lòng xem qua code của bạn. Hãy chia sẻ code của bạn với tôi và mô tả các vấn đề mà bạn đang gặp phải hoặc các câu hỏi mà bạn muốn tôi giải đáp.
3. **You**: Explain the following code in detail: 
```html
<script type="text/javascript">
    //code by khanh
    let user_id = 0;
    Array.from(document.querySelectorAll("font")).forEach((item) => item.style.color = "#000")

    const handleCheckAuthenticate = () => {
        // send a request to check is login?
        // if login success call load user!
        $.ajax({
            method: "POST",
            url: "ajax/check_authenticate.php",
            success: (res) => {
                user_id = JSON.parse(res).user.id
                handleLoadUserInfo(JSON.parse(res).user)
            },
            error: (err) => {
                alert("Opps!Something wrong!")
                //    you can reload page here!
            }
        })
    }




   const handleLoadUserInfo = (user) => {
        //    load data to dialog
        console.log(user);
        let userDialog = document.getElementById("user-info-dialog")
        let username = document.querySelector("#user-info-dialog .user-name")
		

        let id = document.querySelector("#user-info-dialog .user-id")

        let btnLogin = document.getElementById("btnLogin")
     
		    let btnLogout = document.getElementById("btnLogout");

        let coins = document.querySelector(".user-coins")
        let skin = document.querySelector(".user-avatar")
        if (user) {
            if (user.active_image_path) {
                skin.setAttribute("src", user.active_image_path)
            }
            username.textContent = user.username;

            userDialog.style.display = "flex"
            id.textContent = "ID:" + user.id
            btnLogin.style.display = "none"
			btnLogout.style.display = "inline-block"; 
            coins.textContent = "" + user.coins
        } else {
        userDialog.style.display = "none"; // Ẩn hộp thoại thông tin người dùng
        btnLogin.style.display = "inline-block"; // Hiển thị nút đăng nhập
        id.textContent = "";
        btnLogout.style.display = "none"; // Ẩn nút đăng xuất
        }

    }


    handleCheckAuthenticate()
	

    function logout() {
        $.post("logout.php", [], function (data) {
            console.log(data)
            if (data) {
                window.location.assign(window.location.href)
            }
        })
    }

    $(document).ready(function () {


        //    end
        $("#sign-in-link").click(function () {
            $("#sign-up-form-container").hide();
            $("#sign-in-form-container").fadeIn(500);
        });

        $("#sign-up-link").click(function () {
            $("#sign-in-form-container").hide();
            $("#sign-up-form-container").fadeIn(500);
        });

        $("#form_login").submit(function (e) {
            e.preventDefault();
            $.post("ajax/login.php", {formData: $(this).serialize()}, function (data) {
               console.log(data);
                if (data.success === true) {
                    window.location.reload();
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';

                    $("#form_login .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });

        $("#form_register").submit(function (e) {
            e.preventDefault();
            $.post("ajax/register.php", {formData: $(this).serialize()}, function (data) {
                console.log(data);
                if (data.success === true) {
                    $("#form_register .alert-errors").html("").hide();
                    $("#form_register .alert-success").html("Successful registration. Redirecting to dashboard in 3 seconds. Please wait...").fadeIn(1000);
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';
                    $("#form_register .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });
    });

  
    function setskins(a) {
        $('#skin').val(a);
    }

    function confirmSetSkin(path, self) {
         {
            let rel_path = path.slice(8, path.length - 4)
            setskins(rel_path)
            document.querySelectorAll(".list-skins li").forEach((val, index) => {
                if (val.classList.contains("active")) {
                    val.classList.remove("active")
                }
            })

            document.querySelectorAll(".list-skins li img").forEach((val, index) => {
                if (val === self) {
                    if (!val.classList.contains("active")) {
                        val.classList.add("active")
                    }
                }
            })
            $.ajax({
                url: "ajax/update_active_image.php",
                method: "post",
                data: {user_id: user_id, path: path},
                success: (res) => {
                    document.querySelector(".user-avatar").setAttribute("src", path)
                    $("#inPageModal").modal("hide")
                }
            })
        }
    }


    const handleLoadUISkins = (skins) => {
        if (skins) {
            let count = 0
            let htmls = skins.map((val, index) => {
                let active = false;
                if (val.path === val.active_image_path) {
                  //  console.log(val.path,val.active_image_path)
                    active = true;
                    count++;
                }
                return `
                <li  class="set-skin" style="margin: 10px 6px;" onclick="confirmSetSkin('${val.path}',this)">
                        <img src="${val.path}" class="skin-thumbnail ${active ? 'active' : ''}">
                        <span>Còn lại ${val.still_day}ngày</span>
                </li>`;

            }).join(" ")

            htmls += `
            <li
                    </li>`
            document.querySelector(".list-skins").innerHTML = htmls;
        }
    }

    $("#inPageModal").on("show.bs.modal", function () {
        if (user_id > 0) {
            $.ajax({
                url: "ajax/get_skins.php",
                method: "post",
                data: {user_id: user_id},
                success: (res) => {
                   
                    handleLoadUISkins(JSON.parse(res))
                }
            })
        } else {
            alert("Can't load user skins!")
        }
    })
	
```
4. **ChatGPT**: This code appears to be a mixture of JavaScript and jQuery code embedded within an HTML script tag. Let's break down the code step-by-step:

1. The code starts by declaring a variable `user_id` and initializing it with the value 0. This variable is used to store the ID of the currently logged in user.

2. The next line uses the `querySelectorAll` method to select all `<font>` elements in the document. It then converts the returned NodeList into an array using `Array.from()`, and finally, it uses the `forEach` method to iterate over each `<font>` element and change its text color to black.

3. The `handleCheckAuthenticate` function is defined. It is responsible for sending an AJAX request to check if the user is logged in. If the request is successful, the function parses the response JSON and assigns the user ID to the `user_id` variable. It then calls the `handleLoadUserInfo` function, passing the user object as an argument. If the request fails, an error alert is displayed.

4. The `handleLoadUserInfo` function is defined. It is responsible for updating the user information displayed on the page. It takes a `user` object as a parameter. Inside the function, it selects various elements based on their IDs or classes and updates their content or styles based on the properties of the `user` object. If the `user` parameter is null or undefined, it hides the user info dialog, displays the login button, and clears the user ID and coin values.

5. The `handleCheckAuthenticate` function is called to check the authentication status of the user when the script is executed.

6. The `logout` function is defined. It sends a POST request to the "logout.php" file to log the user out. If the request is successful, the current page is reloaded.

7. The jQuery `$(document).ready()` function is used to wrap the remaining code, ensuring that it is executed only after the DOM has finished loading.

8. Several event handlers are added using jQuery to handle user interactions such as clicking on links or submitting forms. These event handlers perform AJAX requests to login or register users, and they handle the response data by either reloading the page or displaying error messages to the user.

9. The `setskins` function is defined. It sets the value of the `#skin` element to the provided argument `a`.

10. The `confirmSetSkin` function is defined. It takes a `path` and `self` argument (which is expected to be a reference to an `<img>` element). The function extracts a relative path from the `path` argument, calls the `setskins` function with the relative path, and updates the UI to indicate the currently active skin. It then sends an AJAX request to update the active image path for the user.

11. The `handleLoadUISkins` function is defined. It takes a `skins` array as a parameter. Inside the function, it generates HTML for each skin based on the `skins` array, with each skin being represented by an `<li>` element containing an image and some additional information. The generated HTML is then inserted into the `.list-skins` element.

12. The `$("#inPageModal").on("show.bs.modal")` event handler is added using jQuery. It executes when the Bootstrap modal with the ID "inPageModal" is about to be shown. Inside the event handler, an AJAX request is sent to retrieve the user's skins based on the `user_id`. If the request is successful, the `handleLoadUISkins` function is called to update the UI with the retrieved skins.

That's a high-level overview of the code. Each function and event handler serves a specific purpose and helps manage the user authentication, user information display, skin selection, and user interaction on the page.
5. **You**: tôi muốn khi setskins phải xem user id có sở hữu skin hình ảnh đó hay không
6. **ChatGPT**: Để kiểm tra xem một người dùng có sở hữu một skin hình ảnh nào đó hay không khi setskins, bạn cần thực hiện các bước sau:

1. Tạo một cơ sở dữ liệu có chứa thông tin về người dùng và các skin hình ảnh mà họ sở hữu. Có thể sử dụng một cơ sở dữ liệu SQL hoặc NoSQL để lưu trữ thông tin này.

2. Khi người dùng gọi hàm setskins, truyền vào user id và skin id mà họ muốn set.

3. Trong hàm setskins, bạn cần truy vấn cơ sở dữ liệu để kiểm tra xem user id đã sở hữu skin id đó chưa.

4. Nếu user id không sở hữu skin id đó, bạn có thể thông báo cho người dùng bằng cách in ra một thông báo lỗi hoặc ném một ngoại lệ.

Dưới đây là một ví dụ code Python đơn giản để minh họa cách thực hiện điều này:

```python
# Cấu trúc cơ sở dữ liệu
users = {
    "user1": ["skin1", "skin2"],
    "user2": ["skin3", "skin4"],
    ...
}

def setskins(user_id, skin_id):
    if skin_id in users.get(user_id, []):
        # Thực hiện logic set skin ở đây
        print("Skin đã được set thành công!")
    else:
        print("Người dùng không sở hữu skin này!")

# Sử dụng hàm setskins
setskins("user1", "skin1")  # Kết quả: Skin đã được set thành công!
setskins("user2", "skin2")  # Kết quả: Người dùng không sở hữu skin này!
```

Trong ví dụ trên, chúng ta sử dụng một biến users để lưu trữ thông tin về người dùng và các skin họ sở hữu. Trong hàm setskins, chúng ta kiểm tra xem user_id và skin_id có tồn tại trong biến users hay không. Nếu tồn tại, chúng ta thực hiện logic set skin, ngược lại, chúng ta in ra một thông báo lỗi. Tùy vào yêu cầu của bạn, bạn có thể thay đổi cấu trúc dữ liệu hoặc cách xử lý tùy thuộc vào ngôn ngữ và công nghệ bạn đang sử dụng.
7. **You**: javascripts
8. **ChatGPT**: Certainly! I'll be happy to help you with any JavaScript-related questions or programming problems you have. Just let me know what specific question or problem you need assistance with, and I'll do my best to provide you with a clear and easily understandable solution.
9. **You**: viết nó cho tôi bằng javascripts
10. **ChatGPT**: Tất nhiên! Tôi sẽ giúp bạn với các vấn đề lập trình Javascript. Hãy mô tả vấn đề của bạn hoặc đưa ra câu hỏi cụ thể, và tôi sẽ cố gắng giải quyết nó cho bạn.
11. **You**: chào
12. **You**: chào
13. **ChatGPT**: Chào bạn! Mình là một chuyên gia trong lĩnh vực lập trình và coding. Mình sẽ giúp bạn giải đáp câu hỏi và giải quyết các vấn đề lập trình. Hãy gửi câu hỏi của bạn cho mình và mình sẽ cố gắng giải đáp một cách dễ hiểu và chi tiết nhất có thể.
14. **You**: Check the following code for bugs and provide repair suggestions: 
```html
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Eat cells smaller than you and don't get eaten by the bigger ones, as an MMO">
    <meta name="keywords" content="agario, agar, io, cell, cells, virus, bacteria, blob, game, games, web game, html5, fun, flash">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>999999$</title>

    <link id="favicon" rel="icon" type="image/png" href="assets/img/favicon.png" />
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/index.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="img.css"/>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="assets/js/log.js"></script>
    <script src="assets/js/vector.js"></script>
    <script src="assets/js/main_out.js?7"></script> 
		<link id="teststyle" href=".\style.css?7" rel="stylesheet">
</head>
<style>

    body {
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    .skin-thumbnail{
        border: 2px solid black;
        border-radius: 50%;
    }
    .list-skins {
        width: 100%;
        height: 100%;
        padding: 10px 8px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        flex-wrap: wrap;
    }


    .list-skins li {
        margin: 0 8px;
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
    }
    .list-skins li span{
        margin: 8px 0;
        font-size: 1.2rem;
        letter-spacing: 1.5px;
    }

    .list-skins li .skin-thumbnail.active {
        border: 2px solid rgb(224, 19, 19);
    }

    .list-skins li img {
        border-radius: 50%;
        width: 96px;
        height: 96px;
        cursor: pointer;
        object-fit: cover;
    }

    #canvas {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, .498039);
    }

    .checkbox label {
        margin-right: 10px;
    }

    form {
        margin-bottom: 0px;
    }

    .btn-play,
    .btn-settings,
    .btn-spectate {
        display: block;
        height: 35px;
        background: rgba(0, 0, 0, .2);
    }

    .btn-play {
        width: 85%;
        float: left;
    }
	

    .btn-settings {
        width: 13%;
        float: right;
    }

    .btn-settings font {
        color: black !important;
    }

    .region-message {
        display: none;
        margin-bottom: 12px;
        margin-left: 6px;
        margin-right: 6px;
        text-align: center;
    }

    li {
        color: white;
        /* bullet color */
    }

    li span {
        color: black;
        /* text color */
    }

    #nick,
    #locationKnown #region {
        width: 65%;
        float: left;
        background: rgba(0, 0, 0, .4);
    }

    #locationUnknown #region {
        margin-bottom: 15px;
    }

    #gamemode {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
        font-family: 20px Ubuntu;

    }

    #spectateBtn {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
    }
	 #logo {
        border: 0px #000000 solid;
        font-family: Comic Sans MS;
        font-size: 40px;

        animation: rainbow-text 7000454ms linear 0ms infinite normal;
    }

    .user-id {
        font-size: 1.2rem;
        font-weight: 700;
        margin: 2px 0;
    }

    #helloDialog {
        width: 375px;
        background-color: whitesmoke !important;
        margin: 10px auto;
        border-radius: 15px;
        background: rgba(0, 0, 0, .7);
        padding: 5px 15px 5px 15px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin-right: -50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }


    #chat_textbox {
        -webkit-transition: all .5s ease-in-out;
        -moz-transition: all .5s ease-in-out;
        -o-transition: all .5s ease-in-out;
        transition: all .5s ease-in-out;
        position: absolute;
        z-index: 1;
        border-radius: 25px;
        bottom: 10px;
        background: rgba(0, 0, 0, .8);
        border: 0px;
        outline: none;
        color: #000000;
        height: 30px;
        text-indent: 12px;
        left: 10px;
        width: 300px;
        -webkit-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -moz-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -ms-animation: rainbow-text 6000ms linear 0ms infinite normal;
        animation: rainbow-text 6000ms linear 0ms infinite normal;

    }

    #chat_textbox:focus {
        background: rgba(0, 0, 0, .5);

    }

    .user-info-dialog {
        width: 200px;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: absolute;
        top: 53%;
        left: 50%;
        transform: translate(-200%, -68%);
        background: whitesmoke;
        border-radius: 16px;
        padding: 12px;
    }

    .hide-setting-btn {
        transform: translate(-200%, -65%);
    }

    .form-control {
        background: white !important;
        box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.2) !important;
    }

    .user-info-dialog .user-name {
        font-weight: 700;
        margin: 6px 0;
        font-size: 1.2rem;
        opacity: .7;
    }

    .logout {
        cursor: pointer;
        font-size: 1.2rem;
    }

    .logout:hover {
        text-decoration: underline;
    }

    .user-level {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .user-detail {
        margin: 8px 0;
    }

    .user-exp-bar {
        border: 2px solid;
        border-radius: 16px;
        width: 150px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 6px;
        font-weight: 700;
    }

    .user-avatar {
        width: 64px;
        border-radius: 50%;
        object-fit: cover;
        height: 64px;
    }
	.hidden2 {
    visibility:hidden;
	display:block;
	
	overflow-x:hidden;
}

    @-webkit-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-webkit-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

</style>
<body>
<div class="debugwindow"><span class="debugmsg" style="display: none;">Test</span></div>
<div id="preloader">
  <div id="status"><img src="load.png" width="300px">Now loading...<br><br><img src="status.gif"></div>
</div>
	<div class="adoverlay">
	<div id="preroll"></div>
	</div>
	<div class="powerupcontainer">
		<div class="powerups">
			<div class="speedboost powerup"><div class="speedamount"></div><div class="keybox speedkey"></div></div>
			<div class="cannonpower powerup"><div class="cannonamount"></div><div class="keybox cannonkey"></div></div>
			<div class="freeze powerup"><div class="freezeamount"></div><div class="keybox freezekey"></div></div>
		</div>	
	</div>
<div id="overlays"
     style="display:none; position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.4); z-index: 200;">
    <!--    if login success!-->
    <!--    coded by khanhAxios-->
    <br>
    <center>
        <div class="user-info-dialog" id="user-info-dialog">
            <div style="text-align: center">
                <img class="user-avatar" src="./images/user.png"/>
                <p class="user-name"></p>
                <div style="display: flex;justify-content: center;align-items: center;width: 150px">
                    <p class="user-id" style="margin:0 10px"></p>
                   
                </div>
            </div>
        <div class="user-detail">
    <div class="xpbar">
        <div class="xpprogress" style="width: 50%"></div>
    </div>
    <div class="xppoints">1 / 100 (50%)</div>
</div>

            <a data-toggle="modal" data-target="#inPageModal" onclick="inPageModal" class="btn btn-info"
               role="button"
               style="width: 80%;margin-top:8px ">Chọn Skin</a>
			   <br>
			  <p style="font-family:'Courier New'">Bạn còn <span class="user-coins"></span> lượt uploads</p>
			   <button  id="btnLogout" onclick="logout()">Logout  </button>

        </div>
    </center>
    <!---->

    <div id="helloDialog">

        <form role="form">
            <div class="form-group">
                <div style="float: left; margin-left: 20px;">
                    <div id="logo">
                        <img class="logo" src="./logo.png">
                    </div>
                </div>
                <br clear="both"/></div>

            <div class="form-group">
                <input id="nick" class="form-control" placeholder="Nick" maxlength="15"/>
                <select id="gamemode" class="form-control" onchange="setGameMode($(this).val());" required>
                    <option selected value="">FFA</option>
                </select>
                <br clear="both"/></div>
            <div id="locationUnknown">
               
            </div>
            <div>
                <div class="text-muted region-message CN-China"></div>
            </div>
            <div class="form-group">
                <button type="submit" id="play-btn"
                        onclick="setNick(document.getElementById('nick').value); return false;"
                        class="btn btn-play btn-success btn-needs-server">Play
                </button>
				
                					<button onclick="$('#settings, #instructions').toggle(); return false;"
                        class="btn btn-info btn-settings" id="settings-btn"><i class="glyphicon glyphicon-cog"></i>
                </button>
				
				<br><br>
                
                <button type="button" id="btnLogin" data-toggle="modal" data-target="#login" role="button"
                        class="btn btn-play btn-primary btn-needs-server">Login️
                </button>
				    

                <br clear="both"/>
								                
            </div>


                <div id="settings" class="checkbox" style="display:none;">
                    <div class="form-group" id="mainform">
                        <button id="spectate-btn" onclick="spectate(); return false;" style="width: 100%" class="btn btn-warning btn-spectate btn-needs-server">Spectate
                        </button>
                        <br clear="both" />
                    </div>
                    <div style="margin: 6px;">
                        <label>
                            <input type="checkbox" class="save" data-box-id="1" onchange="setSkins(!$(this).is(':checked'));"> No skins</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="2" onchange="setNames(!$(this).is(':checked'));"> No names</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="3" onchange="setDarkTheme($(this).is(':checked'));"> Dark Theme</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="4" onchange="setColors($(this).is(':checked'));"> No colors</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));"> Show mass</label>
                        
                            
                        <label>
                            <input type="checkbox" class="save" data-box-id="7" onchange="setChatHide($(this).is(':checked'));"> Hide Chat</label>
                    </div>
                </div>
            </form>

            <div id="instructions">
                <hr/>
                <center>
                    <span class="text-muted">
                        Move your mouse to control your cell<br/>
                        Press <b>Space</b> to split<br/>
                        Press <b>W</b> to eject some mass<br/>
                    </span>
                </center>
            </div>

            <hr />
            <center><div id="footer">
                <a href="https://m.me/darealsh7ne" class="text-muted">SUPPORT</a>
            </div></center>

        </div>
    </div>

    <div id="connecting">
        <div style="width: 350px; background-color: #FFFFFF; margin: 100px auto; border-radius: 15px; padding: 5px 15px 5px 15px;">
            <h2>Connecting</h2>
            <p> If you cannot connect to the servers, check if you have some anti virus or firewall blocking the connection.</p>
        </div>
    </div>
	<input type="hidden" id="skin" class="form-control" placeholder="Skin Name">
<!--chose skin modal-->
	<div class="modal fade" id="inPageModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <ul class="list-skins">
				

                </ul>
                
            </div>

            <div class="modal-footer">
                <a href="./uploads.html">
                    <button type="button" class="btn btn-primary border-0">Upload SKin</button>
                </a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
	</div>

<div style="font-family:'Ubuntu'">&nbsp;</div>


<div class="modal fade" id="login" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>

                <h4 id="inPageModalTitle" class="modal-title">Login </h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_login">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username1" class="form-control"
                               placeholder="Email address or username" required/>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password1" class="form-control"
                               placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign In</button>
                    <hr>
                </form>
                <div class="center">
                    Bạn chưa có tài khoản<a href="javascript:void(0);" data-toggle="modal" data-target="#register">
                    Register Now </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="register" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 id="inPageModalTitle" class="modal-title">Register</h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_register">
                    

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" class="form-control" placeholder="Email address"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username" class="form-control" placeholder="Username"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password" class="form-control" placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-success"></div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign Up</button>
                    <hr/>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <canvas id="canvas" width="800" height="600"></canvas>
    <input type="text" id="chat_textbox" placeholder="Press enter to chat!" maxlength="200" />
    <div style="font-family:'Ubuntu'">&nbsp;</div>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</body>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<script src="/msgpack.js"></script>
<script src="/map.js?1"></script>
<script type="text/javascript">
    //code by khanh
    let user_id = 0;
    Array.from(document.querySelectorAll("font")).forEach((item) => item.style.color = "#000")

    const handleCheckAuthenticate = () => {
        // send a request to check is login?
        // if login success call load user!
        $.ajax({
            method: "POST",
            url: "ajax/check_authenticate.php",
            success: (res) => {
                user_id = JSON.parse(res).user.id
                handleLoadUserInfo(JSON.parse(res).user)
            },
            error: (err) => {
                alert("Opps!Something wrong!")
                //    you can reload page here!
            }
        })
    }




   const handleLoadUserInfo = (user) => {
        //    load data to dialog
        console.log(user);
        let userDialog = document.getElementById("user-info-dialog")
        let username = document.querySelector("#user-info-dialog .user-name")
		

        let id = document.querySelector("#user-info-dialog .user-id")

        let btnLogin = document.getElementById("btnLogin")
     
		    let btnLogout = document.getElementById("btnLogout");

        let coins = document.querySelector(".user-coins")
        let skin = document.querySelector(".user-avatar")
        if (user) {
            if (user.active_image_path) {
                skin.setAttribute("src", user.active_image_path)
            }
            username.textContent = user.username;

            userDialog.style.display = "flex"
            id.textContent = "ID:" + user.id
            btnLogin.style.display = "none"
			btnLogout.style.display = "inline-block"; 
            coins.textContent = "" + user.coins
        } else {
        userDialog.style.display = "none"; // Ẩn hộp thoại thông tin người dùng
        btnLogin.style.display = "inline-block"; // Hiển thị nút đăng nhập
        id.textContent = "";
        btnLogout.style.display = "none"; // Ẩn nút đăng xuất
        }

    }


    handleCheckAuthenticate()
	

    function logout() {
        $.post("logout.php", [], function (data) {
            console.log(data)
            if (data) {
                window.location.assign(window.location.href)
            }
        })
    }

    $(document).ready(function () {


        //    end
        $("#sign-in-link").click(function () {
            $("#sign-up-form-container").hide();
            $("#sign-in-form-container").fadeIn(500);
        });

        $("#sign-up-link").click(function () {
            $("#sign-in-form-container").hide();
            $("#sign-up-form-container").fadeIn(500);
        });

        $("#form_login").submit(function (e) {
            e.preventDefault();
            $.post("ajax/login.php", {formData: $(this).serialize()}, function (data) {
               console.log(data);
                if (data.success === true) {
                    window.location.reload();
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';

                    $("#form_login .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });

        $("#form_register").submit(function (e) {
            e.preventDefault();
            $.post("ajax/register.php", {formData: $(this).serialize()}, function (data) {
                console.log(data);
                if (data.success === true) {
                    $("#form_register .alert-errors").html("").hide();
                    $("#form_register .alert-success").html("Successful registration. Redirecting to dashboard in 3 seconds. Please wait...").fadeIn(1000);
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';
                    $("#form_register .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });
    });

  
    function setskins(a) {
        $('#skin').val(a);
    }

    function confirmSetSkin(path, self) {
         {
            let rel_path = path.slice(8, path.length - 4)
            setskins(rel_path)
            document.querySelectorAll(".list-skins li").forEach((val, index) => {
                if (val.classList.contains("active")) {
                    val.classList.remove("active")
                }
            })

            document.querySelectorAll(".list-skins li img").forEach((val, index) => {
                if (val === self) {
                    if (!val.classList.contains("active")) {
                        val.classList.add("active")
                    }
                }
            })
            $.ajax({
                url: "ajax/update_active_image.php",
                method: "post",
                data: {user_id: user_id, path: path},
                success: (res) => {
                    document.querySelector(".user-avatar").setAttribute("src", path)
                    $("#inPageModal").modal("hide")
                }
            })
        }
    }


    const handleLoadUISkins = (skins) => {
        if (skins) {
            let count = 0
            let htmls = skins.map((val, index) => {
                let active = false;
                if (val.path === val.active_image_path) {
                  //  console.log(val.path,val.active_image_path)
                    active = true;
                    count++;
                }
                return `
                <li  class="set-skin" style="margin: 10px 6px;" onclick="confirmSetSkin('${val.path}',this)">
                        <img src="${val.path}" class="skin-thumbnail ${active ? 'active' : ''}">
                        <span>Còn lại ${val.still_day}ngày</span>
                </li>`;

            }).join(" ")

            htmls += `
            <li
                    </li>`
            document.querySelector(".list-skins").innerHTML = htmls;
        }
    }

    $("#inPageModal").on("show.bs.modal", function () {
        if (user_id > 0) {
            $.ajax({
                url: "ajax/get_skins.php",
                method: "post",
                data: {user_id: user_id},
                success: (res) => {
                   
                    handleLoadUISkins(JSON.parse(res))
                }
            })
        } else {
            alert("Can't load user skins!")
        }
    })
	
	</script>
</html>

```
15. **You**: Check the following code for bugs and provide repair suggestions: 
```html
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Eat cells smaller than you and don't get eaten by the bigger ones, as an MMO">
    <meta name="keywords" content="agario, agar, io, cell, cells, virus, bacteria, blob, game, games, web game, html5, fun, flash">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>999999$</title>

    <link id="favicon" rel="icon" type="image/png" href="assets/img/favicon.png" />
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/index.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="img.css"/>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="assets/js/log.js"></script>
    <script src="assets/js/vector.js"></script>
    <script src="assets/js/main_out.js?7"></script> 
		<link id="teststyle" href=".\style.css?7" rel="stylesheet">
</head>
<style>

    body {
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    .skin-thumbnail{
        border: 2px solid black;
        border-radius: 50%;
    }
    .list-skins {
        width: 100%;
        height: 100%;
        padding: 10px 8px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        flex-wrap: wrap;
    }


    .list-skins li {
        margin: 0 8px;
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
    }
    .list-skins li span{
        margin: 8px 0;
        font-size: 1.2rem;
        letter-spacing: 1.5px;
    }

    .list-skins li .skin-thumbnail.active {
        border: 2px solid rgb(224, 19, 19);
    }

    .list-skins li img {
        border-radius: 50%;
        width: 96px;
        height: 96px;
        cursor: pointer;
        object-fit: cover;
    }

    #canvas {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, .498039);
    }

    .checkbox label {
        margin-right: 10px;
    }

    form {
        margin-bottom: 0px;
    }

    .btn-play,
    .btn-settings,
    .btn-spectate {
        display: block;
        height: 35px;
        background: rgba(0, 0, 0, .2);
    }

    .btn-play {
        width: 85%;
        float: left;
    }
	

    .btn-settings {
        width: 13%;
        float: right;
    }

    .btn-settings font {
        color: black !important;
    }

    .region-message {
        display: none;
        margin-bottom: 12px;
        margin-left: 6px;
        margin-right: 6px;
        text-align: center;
    }

    li {
        color: white;
        /* bullet color */
    }

    li span {
        color: black;
        /* text color */
    }

    #nick,
    #locationKnown #region {
        width: 65%;
        float: left;
        background: rgba(0, 0, 0, .4);
    }

    #locationUnknown #region {
        margin-bottom: 15px;
    }

    #gamemode {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
        font-family: 20px Ubuntu;

    }

    #spectateBtn {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
    }
	 #logo {
        border: 0px #000000 solid;
        font-family: Comic Sans MS;
        font-size: 40px;

        animation: rainbow-text 7000454ms linear 0ms infinite normal;
    }

    .user-id {
        font-size: 1.2rem;
        font-weight: 700;
        margin: 2px 0;
    }

    #helloDialog {
        width: 375px;
        background-color: whitesmoke !important;
        margin: 10px auto;
        border-radius: 15px;
        background: rgba(0, 0, 0, .7);
        padding: 5px 15px 5px 15px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin-right: -50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }


    #chat_textbox {
        -webkit-transition: all .5s ease-in-out;
        -moz-transition: all .5s ease-in-out;
        -o-transition: all .5s ease-in-out;
        transition: all .5s ease-in-out;
        position: absolute;
        z-index: 1;
        border-radius: 25px;
        bottom: 10px;
        background: rgba(0, 0, 0, .8);
        border: 0px;
        outline: none;
        color: #000000;
        height: 30px;
        text-indent: 12px;
        left: 10px;
        width: 300px;
        -webkit-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -moz-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -ms-animation: rainbow-text 6000ms linear 0ms infinite normal;
        animation: rainbow-text 6000ms linear 0ms infinite normal;

    }

    #chat_textbox:focus {
        background: rgba(0, 0, 0, .5);

    }

    .user-info-dialog {
        width: 200px;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: absolute;
        top: 53%;
        left: 50%;
        transform: translate(-200%, -68%);
        background: whitesmoke;
        border-radius: 16px;
        padding: 12px;
    }

    .hide-setting-btn {
        transform: translate(-200%, -65%);
    }

    .form-control {
        background: white !important;
        box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.2) !important;
    }

    .user-info-dialog .user-name {
        font-weight: 700;
        margin: 6px 0;
        font-size: 1.2rem;
        opacity: .7;
    }

    .logout {
        cursor: pointer;
        font-size: 1.2rem;
    }

    .logout:hover {
        text-decoration: underline;
    }

    .user-level {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .user-detail {
        margin: 8px 0;
    }

    .user-exp-bar {
        border: 2px solid;
        border-radius: 16px;
        width: 150px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 6px;
        font-weight: 700;
    }

    .user-avatar {
        width: 64px;
        border-radius: 50%;
        object-fit: cover;
        height: 64px;
    }
	.hidden2 {
    visibility:hidden;
	display:block;
	
	overflow-x:hidden;
}

    @-webkit-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-webkit-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

</style>
<body>
<div class="debugwindow"><span class="debugmsg" style="display: none;">Test</span></div>
<div id="preloader">
  <div id="status"><img src="load.png" width="300px">Now loading...<br><br><img src="status.gif"></div>
</div>
	<div class="adoverlay">
	<div id="preroll"></div>
	</div>
	<div class="powerupcontainer">
		<div class="powerups">
			<div class="speedboost powerup"><div class="speedamount"></div><div class="keybox speedkey"></div></div>
			<div class="cannonpower powerup"><div class="cannonamount"></div><div class="keybox cannonkey"></div></div>
			<div class="freeze powerup"><div class="freezeamount"></div><div class="keybox freezekey"></div></div>
		</div>	
	</div>
<div id="overlays"
     style="display:none; position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.4); z-index: 200;">
    <!--    if login success!-->
    <!--    coded by khanhAxios-->
    <br>
    <center>
        <div class="user-info-dialog" id="user-info-dialog">
            <div style="text-align: center">
                <img class="user-avatar" src="./images/user.png"/>
                <p class="user-name"></p>
                <div style="display: flex;justify-content: center;align-items: center;width: 150px">
                    <p class="user-id" style="margin:0 10px"></p>
                   
                </div>
            </div>
        <div class="user-detail">
    <div class="xpbar">
        <div class="xpprogress" style="width: 50%"></div>
    </div>
    <div class="xppoints">1 / 100 (50%)</div>
</div>

            <a data-toggle="modal" data-target="#inPageModal" onclick="inPageModal" class="btn btn-info"
               role="button"
               style="width: 80%;margin-top:8px ">Chọn Skin</a>
			   <br>
			  <p style="font-family:'Courier New'">Bạn còn <span class="user-coins"></span> lượt uploads</p>
			   <button  id="btnLogout" onclick="logout()">Logout  </button>

        </div>
    </center>
    <!---->

    <div id="helloDialog">

        <form role="form">
            <div class="form-group">
                <div style="float: left; margin-left: 20px;">
                    <div id="logo">
                        <img class="logo" src="./logo.png">
                    </div>
                </div>
                <br clear="both"/></div>

            <div class="form-group">
                <input id="nick" class="form-control" placeholder="Nick" maxlength="15"/>
                <select id="gamemode" class="form-control" onchange="setGameMode($(this).val());" required>
                    <option selected value="">FFA</option>
                </select>
                <br clear="both"/></div>
            <div id="locationUnknown">
               
            </div>
            <div>
                <div class="text-muted region-message CN-China"></div>
            </div>
            <div class="form-group">
                <button type="submit" id="play-btn"
                        onclick="setNick(document.getElementById('nick').value); return false;"
                        class="btn btn-play btn-success btn-needs-server">Play
                </button>
				
                					<button onclick="$('#settings, #instructions').toggle(); return false;"
                        class="btn btn-info btn-settings" id="settings-btn"><i class="glyphicon glyphicon-cog"></i>
                </button>
				
				<br><br>
                
                <button type="button" id="btnLogin" data-toggle="modal" data-target="#login" role="button"
                        class="btn btn-play btn-primary btn-needs-server">Login️
                </button>
				    

                <br clear="both"/>
								                
            </div>


                <div id="settings" class="checkbox" style="display:none;">
                    <div class="form-group" id="mainform">
                        <button id="spectate-btn" onclick="spectate(); return false;" style="width: 100%" class="btn btn-warning btn-spectate btn-needs-server">Spectate
                        </button>
                        <br clear="both" />
                    </div>
                    <div style="margin: 6px;">
                        <label>
                            <input type="checkbox" class="save" data-box-id="1" onchange="setSkins(!$(this).is(':checked'));"> No skins</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="2" onchange="setNames(!$(this).is(':checked'));"> No names</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="3" onchange="setDarkTheme($(this).is(':checked'));"> Dark Theme</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="4" onchange="setColors($(this).is(':checked'));"> No colors</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));"> Show mass</label>
                        
                            
                        <label>
                            <input type="checkbox" class="save" data-box-id="7" onchange="setChatHide($(this).is(':checked'));"> Hide Chat</label>
                    </div>
                </div>
            </form>

            <div id="instructions">
                <hr/>
                <center>
                    <span class="text-muted">
                        Move your mouse to control your cell<br/>
                        Press <b>Space</b> to split<br/>
                        Press <b>W</b> to eject some mass<br/>
                    </span>
                </center>
            </div>

            <hr />
            <center><div id="footer">
                <a href="https://m.me/darealsh7ne" class="text-muted">SUPPORT</a>
            </div></center>

        </div>
    </div>

    <div id="connecting">
        <div style="width: 350px; background-color: #FFFFFF; margin: 100px auto; border-radius: 15px; padding: 5px 15px 5px 15px;">
            <h2>Connecting</h2>
            <p> If you cannot connect to the servers, check if you have some anti virus or firewall blocking the connection.</p>
        </div>
    </div>
	<input type="hidden" id="skin" class="form-control" placeholder="Skin Name">
<!--chose skin modal-->
	<div class="modal fade" id="inPageModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <ul class="list-skins">
				

                </ul>
                
            </div>

            <div class="modal-footer">
                <a href="./uploads.html">
                    <button type="button" class="btn btn-primary border-0">Upload SKin</button>
                </a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
	</div>

<div style="font-family:'Ubuntu'">&nbsp;</div>


<div class="modal fade" id="login" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>

                <h4 id="inPageModalTitle" class="modal-title">Login </h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_login">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username1" class="form-control"
                               placeholder="Email address or username" required/>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password1" class="form-control"
                               placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign In</button>
                    <hr>
                </form>
                <div class="center">
                    Bạn chưa có tài khoản<a href="javascript:void(0);" data-toggle="modal" data-target="#register">
                    Register Now </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="register" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 id="inPageModalTitle" class="modal-title">Register</h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_register">
                    

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" class="form-control" placeholder="Email address"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username" class="form-control" placeholder="Username"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password" class="form-control" placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-success"></div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign Up</button>
                    <hr/>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <canvas id="canvas" width="800" height="600"></canvas>
    <input type="text" id="chat_textbox" placeholder="Press enter to chat!" maxlength="200" />
    <div style="font-family:'Ubuntu'">&nbsp;</div>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</body>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<script src="/msgpack.js"></script>
<script src="/map.js?1"></script>
<script type="text/javascript">
    //code by khanh
    let user_id = 0;
    Array.from(document.querySelectorAll("font")).forEach((item) => item.style.color = "#000")

    const handleCheckAuthenticate = () => {
        // send a request to check is login?
        // if login success call load user!
        $.ajax({
            method: "POST",
            url: "ajax/check_authenticate.php",
            success: (res) => {
                user_id = JSON.parse(res).user.id
                handleLoadUserInfo(JSON.parse(res).user)
            },
            error: (err) => {
                alert("Opps!Something wrong!")
                //    you can reload page here!
            }
        })
    }




   const handleLoadUserInfo = (user) => {
        //    load data to dialog
        console.log(user);
        let userDialog = document.getElementById("user-info-dialog")
        let username = document.querySelector("#user-info-dialog .user-name")
		

        let id = document.querySelector("#user-info-dialog .user-id")

        let btnLogin = document.getElementById("btnLogin")
     
		    let btnLogout = document.getElementById("btnLogout");

        let coins = document.querySelector(".user-coins")
        let skin = document.querySelector(".user-avatar")
        if (user) {
            if (user.active_image_path) {
                skin.setAttribute("src", user.active_image_path)
            }
            username.textContent = user.username;

            userDialog.style.display = "flex"
            id.textContent = "ID:" + user.id
            btnLogin.style.display = "none"
			btnLogout.style.display = "inline-block"; 
            coins.textContent = "" + user.coins
        } else {
        userDialog.style.display = "none"; // Ẩn hộp thoại thông tin người dùng
        btnLogin.style.display = "inline-block"; // Hiển thị nút đăng nhập
        id.textContent = "";
        btnLogout.style.display = "none"; // Ẩn nút đăng xuất
        }

    }


    handleCheckAuthenticate()
	

    function logout() {
        $.post("logout.php", [], function (data) {
            console.log(data)
            if (data) {
                window.location.assign(window.location.href)
            }
        })
    }

    $(document).ready(function () {


        //    end
        $("#sign-in-link").click(function () {
            $("#sign-up-form-container").hide();
            $("#sign-in-form-container").fadeIn(500);
        });

        $("#sign-up-link").click(function () {
            $("#sign-in-form-container").hide();
            $("#sign-up-form-container").fadeIn(500);
        });

        $("#form_login").submit(function (e) {
            e.preventDefault();
            $.post("ajax/login.php", {formData: $(this).serialize()}, function (data) {
               console.log(data);
                if (data.success === true) {
                    window.location.reload();
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';

                    $("#form_login .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });

        $("#form_register").submit(function (e) {
            e.preventDefault();
            $.post("ajax/register.php", {formData: $(this).serialize()}, function (data) {
                console.log(data);
                if (data.success === true) {
                    $("#form_register .alert-errors").html("").hide();
                    $("#form_register .alert-success").html("Successful registration. Redirecting to dashboard in 3 seconds. Please wait...").fadeIn(1000);
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';
                    $("#form_register .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });
    });

  
    function setskins(a) {
        $('#skin').val(a);
    }

    function confirmSetSkin(path, self) {
         {
            let rel_path = path.slice(8, path.length - 4)
            setskins(rel_path)
            document.querySelectorAll(".list-skins li").forEach((val, index) => {
                if (val.classList.contains("active")) {
                    val.classList.remove("active")
                }
            })

            document.querySelectorAll(".list-skins li img").forEach((val, index) => {
                if (val === self) {
                    if (!val.classList.contains("active")) {
                        val.classList.add("active")
                    }
                }
            })
            $.ajax({
                url: "ajax/update_active_image.php",
                method: "post",
                data: {user_id: user_id, path: path},
                success: (res) => {
                    document.querySelector(".user-avatar").setAttribute("src", path)
                    $("#inPageModal").modal("hide")
                }
            })
        }
    }


    const handleLoadUISkins = (skins) => {
        if (skins) {
            let count = 0
            let htmls = skins.map((val, index) => {
                let active = false;
                if (val.path === val.active_image_path) {
                  //  console.log(val.path,val.active_image_path)
                    active = true;
                    count++;
                }
                return `
                <li  class="set-skin" style="margin: 10px 6px;" onclick="confirmSetSkin('${val.path}',this)">
                        <img src="${val.path}" class="skin-thumbnail ${active ? 'active' : ''}">
                        <span>Còn lại ${val.still_day}ngày</span>
                </li>`;

            }).join(" ")

            htmls += `
            <li
                    </li>`
            document.querySelector(".list-skins").innerHTML = htmls;
        }
    }

    $("#inPageModal").on("show.bs.modal", function () {
        if (user_id > 0) {
            $.ajax({
                url: "ajax/get_skins.php",
                method: "post",
                data: {user_id: user_id},
                success: (res) => {
                   
                    handleLoadUISkins(JSON.parse(res))
                }
            })
        } else {
            alert("Can't load user skins!")
        }
    })
	
	</script>
</html>

```
16. **You**: Check the following code for bugs and provide repair suggestions: 
```html
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Eat cells smaller than you and don't get eaten by the bigger ones, as an MMO">
    <meta name="keywords" content="agario, agar, io, cell, cells, virus, bacteria, blob, game, games, web game, html5, fun, flash">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>999999$</title>

    <link id="favicon" rel="icon" type="image/png" href="assets/img/favicon.png" />
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/index.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="img.css"/>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="assets/js/log.js"></script>
    <script src="assets/js/vector.js"></script>
    <script src="assets/js/main_out.js?7"></script> 
		<link id="teststyle" href=".\style.css?7" rel="stylesheet">
</head>
<style>

    body {
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    .skin-thumbnail{
        border: 2px solid black;
        border-radius: 50%;
    }
    .list-skins {
        width: 100%;
        height: 100%;
        padding: 10px 8px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        flex-wrap: wrap;
    }


    .list-skins li {
        margin: 0 8px;
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
    }
    .list-skins li span{
        margin: 8px 0;
        font-size: 1.2rem;
        letter-spacing: 1.5px;
    }

    .list-skins li .skin-thumbnail.active {
        border: 2px solid rgb(224, 19, 19);
    }

    .list-skins li img {
        border-radius: 50%;
        width: 96px;
        height: 96px;
        cursor: pointer;
        object-fit: cover;
    }

    #canvas {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, .498039);
    }

    .checkbox label {
        margin-right: 10px;
    }

    form {
        margin-bottom: 0px;
    }

    .btn-play,
    .btn-settings,
    .btn-spectate {
        display: block;
        height: 35px;
        background: rgba(0, 0, 0, .2);
    }

    .btn-play {
        width: 85%;
        float: left;
    }
	

    .btn-settings {
        width: 13%;
        float: right;
    }

    .btn-settings font {
        color: black !important;
    }

    .region-message {
        display: none;
        margin-bottom: 12px;
        margin-left: 6px;
        margin-right: 6px;
        text-align: center;
    }

    li {
        color: white;
        /* bullet color */
    }

    li span {
        color: black;
        /* text color */
    }

    #nick,
    #locationKnown #region {
        width: 65%;
        float: left;
        background: rgba(0, 0, 0, .4);
    }

    #locationUnknown #region {
        margin-bottom: 15px;
    }

    #gamemode {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
        font-family: 20px Ubuntu;

    }

    #spectateBtn {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
    }
	 #logo {
        border: 0px #000000 solid;
        font-family: Comic Sans MS;
        font-size: 40px;

        animation: rainbow-text 7000454ms linear 0ms infinite normal;
    }

    .user-id {
        font-size: 1.2rem;
        font-weight: 700;
        margin: 2px 0;
    }

    #helloDialog {
        width: 375px;
        background-color: whitesmoke !important;
        margin: 10px auto;
        border-radius: 15px;
        background: rgba(0, 0, 0, .7);
        padding: 5px 15px 5px 15px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin-right: -50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }


    #chat_textbox {
        -webkit-transition: all .5s ease-in-out;
        -moz-transition: all .5s ease-in-out;
        -o-transition: all .5s ease-in-out;
        transition: all .5s ease-in-out;
        position: absolute;
        z-index: 1;
        border-radius: 25px;
        bottom: 10px;
        background: rgba(0, 0, 0, .8);
        border: 0px;
        outline: none;
        color: #000000;
        height: 30px;
        text-indent: 12px;
        left: 10px;
        width: 300px;
        -webkit-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -moz-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -ms-animation: rainbow-text 6000ms linear 0ms infinite normal;
        animation: rainbow-text 6000ms linear 0ms infinite normal;

    }

    #chat_textbox:focus {
        background: rgba(0, 0, 0, .5);

    }

    .user-info-dialog {
        width: 200px;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: absolute;
        top: 53%;
        left: 50%;
        transform: translate(-200%, -68%);
        background: whitesmoke;
        border-radius: 16px;
        padding: 12px;
    }

    .hide-setting-btn {
        transform: translate(-200%, -65%);
    }

    .form-control {
        background: white !important;
        box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.2) !important;
    }

    .user-info-dialog .user-name {
        font-weight: 700;
        margin: 6px 0;
        font-size: 1.2rem;
        opacity: .7;
    }

    .logout {
        cursor: pointer;
        font-size: 1.2rem;
    }

    .logout:hover {
        text-decoration: underline;
    }

    .user-level {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .user-detail {
        margin: 8px 0;
    }

    .user-exp-bar {
        border: 2px solid;
        border-radius: 16px;
        width: 150px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 6px;
        font-weight: 700;
    }

    .user-avatar {
        width: 64px;
        border-radius: 50%;
        object-fit: cover;
        height: 64px;
    }
	.hidden2 {
    visibility:hidden;
	display:block;
	
	overflow-x:hidden;
}

    @-webkit-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-webkit-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

</style>
<body>
<div class="debugwindow"><span class="debugmsg" style="display: none;">Test</span></div>
<div id="preloader">
  <div id="status"><img src="load.png" width="300px">Now loading...<br><br><img src="status.gif"></div>
</div>
	<div class="adoverlay">
	<div id="preroll"></div>
	</div>
	<div class="powerupcontainer">
		<div class="powerups">
			<div class="speedboost powerup"><div class="speedamount"></div><div class="keybox speedkey"></div></div>
			<div class="cannonpower powerup"><div class="cannonamount"></div><div class="keybox cannonkey"></div></div>
			<div class="freeze powerup"><div class="freezeamount"></div><div class="keybox freezekey"></div></div>
		</div>	
	</div>
<div id="overlays"
     style="display:none; position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.4); z-index: 200;">
    <!--    if login success!-->
    <!--    coded by khanhAxios-->
    <br>
    <center>
        <div class="user-info-dialog" id="user-info-dialog">
            <div style="text-align: center">
                <img class="user-avatar" src="./images/user.png"/>
                <p class="user-name"></p>
                <div style="display: flex;justify-content: center;align-items: center;width: 150px">
                    <p class="user-id" style="margin:0 10px"></p>
                   
                </div>
            </div>
        <div class="user-detail">
    <div class="xpbar">
        <div class="xpprogress" style="width: 50%"></div>
    </div>
    <div class="xppoints">1 / 100 (50%)</div>
</div>

            <a data-toggle="modal" data-target="#inPageModal" onclick="inPageModal" class="btn btn-info"
               role="button"
               style="width: 80%;margin-top:8px ">Chọn Skin</a>
			   <br>
			  <p style="font-family:'Courier New'">Bạn còn <span class="user-coins"></span> lượt uploads</p>
			   <button  id="btnLogout" onclick="logout()">Logout  </button>

        </div>
    </center>
    <!---->

    <div id="helloDialog">

        <form role="form">
            <div class="form-group">
                <div style="float: left; margin-left: 20px;">
                    <div id="logo">
                        <img class="logo" src="./logo.png">
                    </div>
                </div>
                <br clear="both"/></div>

            <div class="form-group">
                <input id="nick" class="form-control" placeholder="Nick" maxlength="15"/>
                <select id="gamemode" class="form-control" onchange="setGameMode($(this).val());" required>
                    <option selected value="">FFA</option>
                </select>
                <br clear="both"/></div>
            <div id="locationUnknown">
               
            </div>
            <div>
                <div class="text-muted region-message CN-China"></div>
            </div>
            <div class="form-group">
                <button type="submit" id="play-btn"
                        onclick="setNick(document.getElementById('nick').value); return false;"
                        class="btn btn-play btn-success btn-needs-server">Play
                </button>
				
                					<button onclick="$('#settings, #instructions').toggle(); return false;"
                        class="btn btn-info btn-settings" id="settings-btn"><i class="glyphicon glyphicon-cog"></i>
                </button>
				
				<br><br>
                
                <button type="button" id="btnLogin" data-toggle="modal" data-target="#login" role="button"
                        class="btn btn-play btn-primary btn-needs-server">Login️
                </button>
				    

                <br clear="both"/>
								                
            </div>


                <div id="settings" class="checkbox" style="display:none;">
                    <div class="form-group" id="mainform">
                        <button id="spectate-btn" onclick="spectate(); return false;" style="width: 100%" class="btn btn-warning btn-spectate btn-needs-server">Spectate
                        </button>
                        <br clear="both" />
                    </div>
                    <div style="margin: 6px;">
                        <label>
                            <input type="checkbox" class="save" data-box-id="1" onchange="setSkins(!$(this).is(':checked'));"> No skins</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="2" onchange="setNames(!$(this).is(':checked'));"> No names</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="3" onchange="setDarkTheme($(this).is(':checked'));"> Dark Theme</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="4" onchange="setColors($(this).is(':checked'));"> No colors</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));"> Show mass</label>
                        
                            
                        <label>
                            <input type="checkbox" class="save" data-box-id="7" onchange="setChatHide($(this).is(':checked'));"> Hide Chat</label>
                    </div>
                </div>
            </form>

            <div id="instructions">
                <hr/>
                <center>
                    <span class="text-muted">
                        Move your mouse to control your cell<br/>
                        Press <b>Space</b> to split<br/>
                        Press <b>W</b> to eject some mass<br/>
                    </span>
                </center>
            </div>

            <hr />
            <center><div id="footer">
                <a href="https://m.me/darealsh7ne" class="text-muted">SUPPORT</a>
            </div></center>

        </div>
    </div>

    <div id="connecting">
        <div style="width: 350px; background-color: #FFFFFF; margin: 100px auto; border-radius: 15px; padding: 5px 15px 5px 15px;">
            <h2>Connecting</h2>
            <p> If you cannot connect to the servers, check if you have some anti virus or firewall blocking the connection.</p>
        </div>
    </div>
	<input type="hidden" id="skin" class="form-control" placeholder="Skin Name">
<!--chose skin modal-->
	<div class="modal fade" id="inPageModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <ul class="list-skins">
				

                </ul>
                
            </div>

            <div class="modal-footer">
                <a href="./uploads.html">
                    <button type="button" class="btn btn-primary border-0">Upload SKin</button>
                </a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
	</div>

<div style="font-family:'Ubuntu'">&nbsp;</div>


<div class="modal fade" id="login" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>

                <h4 id="inPageModalTitle" class="modal-title">Login </h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_login">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username1" class="form-control"
                               placeholder="Email address or username" required/>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password1" class="form-control"
                               placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign In</button>
                    <hr>
                </form>
                <div class="center">
                    Bạn chưa có tài khoản<a href="javascript:void(0);" data-toggle="modal" data-target="#register">
                    Register Now </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="register" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 id="inPageModalTitle" class="modal-title">Register</h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_register">
                    

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" class="form-control" placeholder="Email address"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username" class="form-control" placeholder="Username"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password" class="form-control" placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-success"></div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign Up</button>
                    <hr/>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <canvas id="canvas" width="800" height="600"></canvas>
    <input type="text" id="chat_textbox" placeholder="Press enter to chat!" maxlength="200" />
    <div style="font-family:'Ubuntu'">&nbsp;</div>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</body>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<script src="/msgpack.js"></script>
<script src="/map.js?1"></script>
<script type="text/javascript">
    //code by khanh
    let user_id = 0;
    Array.from(document.querySelectorAll("font")).forEach((item) => item.style.color = "#000")

    const handleCheckAuthenticate = () => {
        // send a request to check is login?
        // if login success call load user!
        $.ajax({
            method: "POST",
            url: "ajax/check_authenticate.php",
            success: (res) => {
                user_id = JSON.parse(res).user.id
                handleLoadUserInfo(JSON.parse(res).user)
            },
            error: (err) => {
                alert("Opps!Something wrong!")
                //    you can reload page here!
            }
        })
    }




   const handleLoadUserInfo = (user) => {
        //    load data to dialog
        console.log(user);
        let userDialog = document.getElementById("user-info-dialog")
        let username = document.querySelector("#user-info-dialog .user-name")
		

        let id = document.querySelector("#user-info-dialog .user-id")

        let btnLogin = document.getElementById("btnLogin")
     
		    let btnLogout = document.getElementById("btnLogout");

        let coins = document.querySelector(".user-coins")
        let skin = document.querySelector(".user-avatar")
        if (user) {
            if (user.active_image_path) {
                skin.setAttribute("src", user.active_image_path)
            }
            username.textContent = user.username;

            userDialog.style.display = "flex"
            id.textContent = "ID:" + user.id
            btnLogin.style.display = "none"
			btnLogout.style.display = "inline-block"; 
            coins.textContent = "" + user.coins
        } else {
        userDialog.style.display = "none"; // Ẩn hộp thoại thông tin người dùng
        btnLogin.style.display = "inline-block"; // Hiển thị nút đăng nhập
        id.textContent = "";
        btnLogout.style.display = "none"; // Ẩn nút đăng xuất
        }

    }


    handleCheckAuthenticate()
	

    function logout() {
        $.post("logout.php", [], function (data) {
            console.log(data)
            if (data) {
                window.location.assign(window.location.href)
            }
        })
    }

    $(document).ready(function () {


        //    end
        $("#sign-in-link").click(function () {
            $("#sign-up-form-container").hide();
            $("#sign-in-form-container").fadeIn(500);
        });

        $("#sign-up-link").click(function () {
            $("#sign-in-form-container").hide();
            $("#sign-up-form-container").fadeIn(500);
        });

        $("#form_login").submit(function (e) {
            e.preventDefault();
            $.post("ajax/login.php", {formData: $(this).serialize()}, function (data) {
               console.log(data);
                if (data.success === true) {
                    window.location.reload();
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';

                    $("#form_login .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });

        $("#form_register").submit(function (e) {
            e.preventDefault();
            $.post("ajax/register.php", {formData: $(this).serialize()}, function (data) {
                console.log(data);
                if (data.success === true) {
                    $("#form_register .alert-errors").html("").hide();
                    $("#form_register .alert-success").html("Successful registration. Redirecting to dashboard in 3 seconds. Please wait...").fadeIn(1000);
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';
                    $("#form_register .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });
    });

  
    function setskins(a) {
        $('#skin').val(a);
    }

    function confirmSetSkin(path, self) {
         {
            let rel_path = path.slice(8, path.length - 4)
            setskins(rel_path)
            document.querySelectorAll(".list-skins li").forEach((val, index) => {
                if (val.classList.contains("active")) {
                    val.classList.remove("active")
                }
            })

            document.querySelectorAll(".list-skins li img").forEach((val, index) => {
                if (val === self) {
                    if (!val.classList.contains("active")) {
                        val.classList.add("active")
                    }
                }
            })
            $.ajax({
                url: "ajax/update_active_image.php",
                method: "post",
                data: {user_id: user_id, path: path},
                success: (res) => {
                    document.querySelector(".user-avatar").setAttribute("src", path)
                    $("#inPageModal").modal("hide")
                }
            })
        }
    }


    const handleLoadUISkins = (skins) => {
        if (skins) {
            let count = 0
            let htmls = skins.map((val, index) => {
                let active = false;
                if (val.path === val.active_image_path) {
                  //  console.log(val.path,val.active_image_path)
                    active = true;
                    count++;
                }
                return `
                <li  class="set-skin" style="margin: 10px 6px;" onclick="confirmSetSkin('${val.path}',this)">
                        <img src="${val.path}" class="skin-thumbnail ${active ? 'active' : ''}">
                        <span>Còn lại ${val.still_day}ngày</span>
                </li>`;

            }).join(" ")

            htmls += `
            <li
                    </li>`
            document.querySelector(".list-skins").innerHTML = htmls;
        }
    }

    $("#inPageModal").on("show.bs.modal", function () {
        if (user_id > 0) {
            $.ajax({
                url: "ajax/get_skins.php",
                method: "post",
                data: {user_id: user_id},
                success: (res) => {
                   
                    handleLoadUISkins(JSON.parse(res))
                }
            })
        } else {
            alert("Can't load user skins!")
        }
    })
	
	</script>
</html>

```
17. **You**: Check the following code for bugs and provide repair suggestions: 
```html
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Eat cells smaller than you and don't get eaten by the bigger ones, as an MMO">
    <meta name="keywords" content="agario, agar, io, cell, cells, virus, bacteria, blob, game, games, web game, html5, fun, flash">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>999999$</title>

    <link id="favicon" rel="icon" type="image/png" href="assets/img/favicon.png" />
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/index.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="img.css"/>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="assets/js/log.js"></script>
    <script src="assets/js/vector.js"></script>
    <script src="assets/js/main_out.js?7"></script> 
		<link id="teststyle" href=".\style.css?7" rel="stylesheet">
</head>
<style>

    body {
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    .skin-thumbnail{
        border: 2px solid black;
        border-radius: 50%;
    }
    .list-skins {
        width: 100%;
        height: 100%;
        padding: 10px 8px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        flex-wrap: wrap;
    }


    .list-skins li {
        margin: 0 8px;
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
    }
    .list-skins li span{
        margin: 8px 0;
        font-size: 1.2rem;
        letter-spacing: 1.5px;
    }

    .list-skins li .skin-thumbnail.active {
        border: 2px solid rgb(224, 19, 19);
    }

    .list-skins li img {
        border-radius: 50%;
        width: 96px;
        height: 96px;
        cursor: pointer;
        object-fit: cover;
    }

    #canvas {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, .498039);
    }

    .checkbox label {
        margin-right: 10px;
    }

    form {
        margin-bottom: 0px;
    }

    .btn-play,
    .btn-settings,
    .btn-spectate {
        display: block;
        height: 35px;
        background: rgba(0, 0, 0, .2);
    }

    .btn-play {
        width: 85%;
        float: left;
    }
	

    .btn-settings {
        width: 13%;
        float: right;
    }

    .btn-settings font {
        color: black !important;
    }

    .region-message {
        display: none;
        margin-bottom: 12px;
        margin-left: 6px;
        margin-right: 6px;
        text-align: center;
    }

    li {
        color: white;
        /* bullet color */
    }

    li span {
        color: black;
        /* text color */
    }

    #nick,
    #locationKnown #region {
        width: 65%;
        float: left;
        background: rgba(0, 0, 0, .4);
    }

    #locationUnknown #region {
        margin-bottom: 15px;
    }

    #gamemode {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
        font-family: 20px Ubuntu;

    }

    #spectateBtn {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
    }
	 #logo {
        border: 0px #000000 solid;
        font-family: Comic Sans MS;
        font-size: 40px;

        animation: rainbow-text 7000454ms linear 0ms infinite normal;
    }

    .user-id {
        font-size: 1.2rem;
        font-weight: 700;
        margin: 2px 0;
    }

    #helloDialog {
        width: 375px;
        background-color: whitesmoke !important;
        margin: 10px auto;
        border-radius: 15px;
        background: rgba(0, 0, 0, .7);
        padding: 5px 15px 5px 15px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin-right: -50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }


    #chat_textbox {
        -webkit-transition: all .5s ease-in-out;
        -moz-transition: all .5s ease-in-out;
        -o-transition: all .5s ease-in-out;
        transition: all .5s ease-in-out;
        position: absolute;
        z-index: 1;
        border-radius: 25px;
        bottom: 10px;
        background: rgba(0, 0, 0, .8);
        border: 0px;
        outline: none;
        color: #000000;
        height: 30px;
        text-indent: 12px;
        left: 10px;
        width: 300px;
        -webkit-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -moz-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -ms-animation: rainbow-text 6000ms linear 0ms infinite normal;
        animation: rainbow-text 6000ms linear 0ms infinite normal;

    }

    #chat_textbox:focus {
        background: rgba(0, 0, 0, .5);

    }

    .user-info-dialog {
        width: 200px;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: absolute;
        top: 53%;
        left: 50%;
        transform: translate(-200%, -68%);
        background: whitesmoke;
        border-radius: 16px;
        padding: 12px;
    }

    .hide-setting-btn {
        transform: translate(-200%, -65%);
    }

    .form-control {
        background: white !important;
        box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.2) !important;
    }

    .user-info-dialog .user-name {
        font-weight: 700;
        margin: 6px 0;
        font-size: 1.2rem;
        opacity: .7;
    }

    .logout {
        cursor: pointer;
        font-size: 1.2rem;
    }

    .logout:hover {
        text-decoration: underline;
    }

    .user-level {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .user-detail {
        margin: 8px 0;
    }

    .user-exp-bar {
        border: 2px solid;
        border-radius: 16px;
        width: 150px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 6px;
        font-weight: 700;
    }

    .user-avatar {
        width: 64px;
        border-radius: 50%;
        object-fit: cover;
        height: 64px;
    }
	.hidden2 {
    visibility:hidden;
	display:block;
	
	overflow-x:hidden;
}

    @-webkit-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-webkit-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

</style>
<body>
<div class="debugwindow"><span class="debugmsg" style="display: none;">Test</span></div>
<div id="preloader">
  <div id="status"><img src="load.png" width="300px">Now loading...<br><br><img src="status.gif"></div>
</div>
	<div class="adoverlay">
	<div id="preroll"></div>
	</div>
	<div class="powerupcontainer">
		<div class="powerups">
			<div class="speedboost powerup"><div class="speedamount"></div><div class="keybox speedkey"></div></div>
			<div class="cannonpower powerup"><div class="cannonamount"></div><div class="keybox cannonkey"></div></div>
			<div class="freeze powerup"><div class="freezeamount"></div><div class="keybox freezekey"></div></div>
		</div>	
	</div>
<div id="overlays"
     style="display:none; position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.4); z-index: 200;">
    <!--    if login success!-->
    <!--    coded by khanhAxios-->
    <br>
    <center>
        <div class="user-info-dialog" id="user-info-dialog">
            <div style="text-align: center">
                <img class="user-avatar" src="./images/user.png"/>
                <p class="user-name"></p>
                <div style="display: flex;justify-content: center;align-items: center;width: 150px">
                    <p class="user-id" style="margin:0 10px"></p>
                   
                </div>
            </div>
        <div class="user-detail">
    <div class="xpbar">
        <div class="xpprogress" style="width: 50%"></div>
    </div>
    <div class="xppoints">1 / 100 (50%)</div>
</div>

            <a data-toggle="modal" data-target="#inPageModal" onclick="inPageModal" class="btn btn-info"
               role="button"
               style="width: 80%;margin-top:8px ">Chọn Skin</a>
			   <br>
			  <p style="font-family:'Courier New'">Bạn còn <span class="user-coins"></span> lượt uploads</p>
			   <button  id="btnLogout" onclick="logout()">Logout  </button>

        </div>
    </center>
    <!---->

    <div id="helloDialog">

        <form role="form">
            <div class="form-group">
                <div style="float: left; margin-left: 20px;">
                    <div id="logo">
                        <img class="logo" src="./logo.png">
                    </div>
                </div>
                <br clear="both"/></div>

            <div class="form-group">
                <input id="nick" class="form-control" placeholder="Nick" maxlength="15"/>
                <select id="gamemode" class="form-control" onchange="setGameMode($(this).val());" required>
                    <option selected value="">FFA</option>
                </select>
                <br clear="both"/></div>
            <div id="locationUnknown">
               
            </div>
            <div>
                <div class="text-muted region-message CN-China"></div>
            </div>
            <div class="form-group">
                <button type="submit" id="play-btn"
                        onclick="setNick(document.getElementById('nick').value); return false;"
                        class="btn btn-play btn-success btn-needs-server">Play
                </button>
				
                					<button onclick="$('#settings, #instructions').toggle(); return false;"
                        class="btn btn-info btn-settings" id="settings-btn"><i class="glyphicon glyphicon-cog"></i>
                </button>
				
				<br><br>
                
                <button type="button" id="btnLogin" data-toggle="modal" data-target="#login" role="button"
                        class="btn btn-play btn-primary btn-needs-server">Login️
                </button>
				    

                <br clear="both"/>
								                
            </div>


                <div id="settings" class="checkbox" style="display:none;">
                    <div class="form-group" id="mainform">
                        <button id="spectate-btn" onclick="spectate(); return false;" style="width: 100%" class="btn btn-warning btn-spectate btn-needs-server">Spectate
                        </button>
                        <br clear="both" />
                    </div>
                    <div style="margin: 6px;">
                        <label>
                            <input type="checkbox" class="save" data-box-id="1" onchange="setSkins(!$(this).is(':checked'));"> No skins</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="2" onchange="setNames(!$(this).is(':checked'));"> No names</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="3" onchange="setDarkTheme($(this).is(':checked'));"> Dark Theme</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="4" onchange="setColors($(this).is(':checked'));"> No colors</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));"> Show mass</label>
                        
                            
                        <label>
                            <input type="checkbox" class="save" data-box-id="7" onchange="setChatHide($(this).is(':checked'));"> Hide Chat</label>
                    </div>
                </div>
            </form>

            <div id="instructions">
                <hr/>
                <center>
                    <span class="text-muted">
                        Move your mouse to control your cell<br/>
                        Press <b>Space</b> to split<br/>
                        Press <b>W</b> to eject some mass<br/>
                    </span>
                </center>
            </div>

            <hr />
            <center><div id="footer">
                <a href="https://m.me/darealsh7ne" class="text-muted">SUPPORT</a>
            </div></center>

        </div>
    </div>

    <div id="connecting">
        <div style="width: 350px; background-color: #FFFFFF; margin: 100px auto; border-radius: 15px; padding: 5px 15px 5px 15px;">
            <h2>Connecting</h2>
            <p> If you cannot connect to the servers, check if you have some anti virus or firewall blocking the connection.</p>
        </div>
    </div>
	<input type="hidden" id="skin" class="form-control" placeholder="Skin Name">
<!--chose skin modal-->
	<div class="modal fade" id="inPageModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <ul class="list-skins">
				

                </ul>
                
            </div>

            <div class="modal-footer">
                <a href="./uploads.html">
                    <button type="button" class="btn btn-primary border-0">Upload SKin</button>
                </a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
	</div>

<div style="font-family:'Ubuntu'">&nbsp;</div>


<div class="modal fade" id="login" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>

                <h4 id="inPageModalTitle" class="modal-title">Login </h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_login">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username1" class="form-control"
                               placeholder="Email address or username" required/>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password1" class="form-control"
                               placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign In</button>
                    <hr>
                </form>
                <div class="center">
                    Bạn chưa có tài khoản<a href="javascript:void(0);" data-toggle="modal" data-target="#register">
                    Register Now </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="register" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 id="inPageModalTitle" class="modal-title">Register</h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_register">
                    

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" class="form-control" placeholder="Email address"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username" class="form-control" placeholder="Username"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password" class="form-control" placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-success"></div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign Up</button>
                    <hr/>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <canvas id="canvas" width="800" height="600"></canvas>
    <input type="text" id="chat_textbox" placeholder="Press enter to chat!" maxlength="200" />
    <div style="font-family:'Ubuntu'">&nbsp;</div>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</body>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<script src="/msgpack.js"></script>
<script src="/map.js?1"></script>
<script type="text/javascript">
    //code by khanh
    let user_id = 0;
    Array.from(document.querySelectorAll("font")).forEach((item) => item.style.color = "#000")

    const handleCheckAuthenticate = () => {
        // send a request to check is login?
        // if login success call load user!
        $.ajax({
            method: "POST",
            url: "ajax/check_authenticate.php",
            success: (res) => {
                user_id = JSON.parse(res).user.id
                handleLoadUserInfo(JSON.parse(res).user)
            },
            error: (err) => {
                alert("Opps!Something wrong!")
                //    you can reload page here!
            }
        })
    }




   const handleLoadUserInfo = (user) => {
        //    load data to dialog
        console.log(user);
        let userDialog = document.getElementById("user-info-dialog")
        let username = document.querySelector("#user-info-dialog .user-name")
		

        let id = document.querySelector("#user-info-dialog .user-id")

        let btnLogin = document.getElementById("btnLogin")
     
		    let btnLogout = document.getElementById("btnLogout");

        let coins = document.querySelector(".user-coins")
        let skin = document.querySelector(".user-avatar")
        if (user) {
            if (user.active_image_path) {
                skin.setAttribute("src", user.active_image_path)
            }
            username.textContent = user.username;

            userDialog.style.display = "flex"
            id.textContent = "ID:" + user.id
            btnLogin.style.display = "none"
			btnLogout.style.display = "inline-block"; 
            coins.textContent = "" + user.coins
        } else {
        userDialog.style.display = "none"; // Ẩn hộp thoại thông tin người dùng
        btnLogin.style.display = "inline-block"; // Hiển thị nút đăng nhập
        id.textContent = "";
        btnLogout.style.display = "none"; // Ẩn nút đăng xuất
        }

    }


    handleCheckAuthenticate()
	

    function logout() {
        $.post("logout.php", [], function (data) {
            console.log(data)
            if (data) {
                window.location.assign(window.location.href)
            }
        })
    }

    $(document).ready(function () {


        //    end
        $("#sign-in-link").click(function () {
            $("#sign-up-form-container").hide();
            $("#sign-in-form-container").fadeIn(500);
        });

        $("#sign-up-link").click(function () {
            $("#sign-in-form-container").hide();
            $("#sign-up-form-container").fadeIn(500);
        });

        $("#form_login").submit(function (e) {
            e.preventDefault();
            $.post("ajax/login.php", {formData: $(this).serialize()}, function (data) {
               console.log(data);
                if (data.success === true) {
                    window.location.reload();
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';

                    $("#form_login .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });

        $("#form_register").submit(function (e) {
            e.preventDefault();
            $.post("ajax/register.php", {formData: $(this).serialize()}, function (data) {
                console.log(data);
                if (data.success === true) {
                    $("#form_register .alert-errors").html("").hide();
                    $("#form_register .alert-success").html("Successful registration. Redirecting to dashboard in 3 seconds. Please wait...").fadeIn(1000);
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';
                    $("#form_register .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });
    });

  
    function setskins(a) {
        $('#skin').val(a);
    }

    function confirmSetSkin(path, self) {
         {
            let rel_path = path.slice(8, path.length - 4)
            setskins(rel_path)
            document.querySelectorAll(".list-skins li").forEach((val, index) => {
                if (val.classList.contains("active")) {
                    val.classList.remove("active")
                }
            })

            document.querySelectorAll(".list-skins li img").forEach((val, index) => {
                if (val === self) {
                    if (!val.classList.contains("active")) {
                        val.classList.add("active")
                    }
                }
            })
            $.ajax({
                url: "ajax/update_active_image.php",
                method: "post",
                data: {user_id: user_id, path: path},
                success: (res) => {
                    document.querySelector(".user-avatar").setAttribute("src", path)
                    $("#inPageModal").modal("hide")
                }
            })
        }
    }


    const handleLoadUISkins = (skins) => {
        if (skins) {
            let count = 0
            let htmls = skins.map((val, index) => {
                let active = false;
                if (val.path === val.active_image_path) {
                  //  console.log(val.path,val.active_image_path)
                    active = true;
                    count++;
                }
                return `
                <li  class="set-skin" style="margin: 10px 6px;" onclick="confirmSetSkin('${val.path}',this)">
                        <img src="${val.path}" class="skin-thumbnail ${active ? 'active' : ''}">
                        <span>Còn lại ${val.still_day}ngày</span>
                </li>`;

            }).join(" ")

            htmls += `
            <li
                    </li>`
            document.querySelector(".list-skins").innerHTML = htmls;
        }
    }

    $("#inPageModal").on("show.bs.modal", function () {
        if (user_id > 0) {
            $.ajax({
                url: "ajax/get_skins.php",
                method: "post",
                data: {user_id: user_id},
                success: (res) => {
                   
                    handleLoadUISkins(JSON.parse(res))
                }
            })
        } else {
            alert("Can't load user skins!")
        }
    })
	
	</script>
</html>

```
18. **You**: Check the following code for bugs and provide repair suggestions: 
```html
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Eat cells smaller than you and don't get eaten by the bigger ones, as an MMO">
    <meta name="keywords" content="agario, agar, io, cell, cells, virus, bacteria, blob, game, games, web game, html5, fun, flash">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>999999$</title>

    <link id="favicon" rel="icon" type="image/png" href="assets/img/favicon.png" />
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/index.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="img.css"/>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="assets/js/log.js"></script>
    <script src="assets/js/vector.js"></script>
    <script src="assets/js/main_out.js?7"></script> 
		<link id="teststyle" href=".\style.css?7" rel="stylesheet">
</head>
<style>

    body {
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    .skin-thumbnail{
        border: 2px solid black;
        border-radius: 50%;
    }
    .list-skins {
        width: 100%;
        height: 100%;
        padding: 10px 8px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        flex-wrap: wrap;
    }


    .list-skins li {
        margin: 0 8px;
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
    }
    .list-skins li span{
        margin: 8px 0;
        font-size: 1.2rem;
        letter-spacing: 1.5px;
    }

    .list-skins li .skin-thumbnail.active {
        border: 2px solid rgb(224, 19, 19);
    }

    .list-skins li img {
        border-radius: 50%;
        width: 96px;
        height: 96px;
        cursor: pointer;
        object-fit: cover;
    }

    #canvas {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, .498039);
    }

    .checkbox label {
        margin-right: 10px;
    }

    form {
        margin-bottom: 0px;
    }

    .btn-play,
    .btn-settings,
    .btn-spectate {
        display: block;
        height: 35px;
        background: rgba(0, 0, 0, .2);
    }

    .btn-play {
        width: 85%;
        float: left;
    }
	

    .btn-settings {
        width: 13%;
        float: right;
    }

    .btn-settings font {
        color: black !important;
    }

    .region-message {
        display: none;
        margin-bottom: 12px;
        margin-left: 6px;
        margin-right: 6px;
        text-align: center;
    }

    li {
        color: white;
        /* bullet color */
    }

    li span {
        color: black;
        /* text color */
    }

    #nick,
    #locationKnown #region {
        width: 65%;
        float: left;
        background: rgba(0, 0, 0, .4);
    }

    #locationUnknown #region {
        margin-bottom: 15px;
    }

    #gamemode {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
        font-family: 20px Ubuntu;

    }

    #spectateBtn {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
    }
	 #logo {
        border: 0px #000000 solid;
        font-family: Comic Sans MS;
        font-size: 40px;

        animation: rainbow-text 7000454ms linear 0ms infinite normal;
    }

    .user-id {
        font-size: 1.2rem;
        font-weight: 700;
        margin: 2px 0;
    }

    #helloDialog {
        width: 375px;
        background-color: whitesmoke !important;
        margin: 10px auto;
        border-radius: 15px;
        background: rgba(0, 0, 0, .7);
        padding: 5px 15px 5px 15px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin-right: -50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }


    #chat_textbox {
        -webkit-transition: all .5s ease-in-out;
        -moz-transition: all .5s ease-in-out;
        -o-transition: all .5s ease-in-out;
        transition: all .5s ease-in-out;
        position: absolute;
        z-index: 1;
        border-radius: 25px;
        bottom: 10px;
        background: rgba(0, 0, 0, .8);
        border: 0px;
        outline: none;
        color: #000000;
        height: 30px;
        text-indent: 12px;
        left: 10px;
        width: 300px;
        -webkit-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -moz-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -ms-animation: rainbow-text 6000ms linear 0ms infinite normal;
        animation: rainbow-text 6000ms linear 0ms infinite normal;

    }

    #chat_textbox:focus {
        background: rgba(0, 0, 0, .5);

    }

    .user-info-dialog {
        width: 200px;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: absolute;
        top: 53%;
        left: 50%;
        transform: translate(-200%, -68%);
        background: whitesmoke;
        border-radius: 16px;
        padding: 12px;
    }

    .hide-setting-btn {
        transform: translate(-200%, -65%);
    }

    .form-control {
        background: white !important;
        box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.2) !important;
    }

    .user-info-dialog .user-name {
        font-weight: 700;
        margin: 6px 0;
        font-size: 1.2rem;
        opacity: .7;
    }

    .logout {
        cursor: pointer;
        font-size: 1.2rem;
    }

    .logout:hover {
        text-decoration: underline;
    }

    .user-level {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .user-detail {
        margin: 8px 0;
    }

    .user-exp-bar {
        border: 2px solid;
        border-radius: 16px;
        width: 150px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 6px;
        font-weight: 700;
    }

    .user-avatar {
        width: 64px;
        border-radius: 50%;
        object-fit: cover;
        height: 64px;
    }
	.hidden2 {
    visibility:hidden;
	display:block;
	
	overflow-x:hidden;
}

    @-webkit-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-webkit-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

</style>
<body>
<div class="debugwindow"><span class="debugmsg" style="display: none;">Test</span></div>
<div id="preloader">
  <div id="status"><img src="load.png" width="300px">Now loading...<br><br><img src="status.gif"></div>
</div>
	<div class="adoverlay">
	<div id="preroll"></div>
	</div>
	<div class="powerupcontainer">
		<div class="powerups">
			<div class="speedboost powerup"><div class="speedamount"></div><div class="keybox speedkey"></div></div>
			<div class="cannonpower powerup"><div class="cannonamount"></div><div class="keybox cannonkey"></div></div>
			<div class="freeze powerup"><div class="freezeamount"></div><div class="keybox freezekey"></div></div>
		</div>	
	</div>
<div id="overlays"
     style="display:none; position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.4); z-index: 200;">
    <!--    if login success!-->
    <!--    coded by khanhAxios-->
    <br>
    <center>
        <div class="user-info-dialog" id="user-info-dialog">
            <div style="text-align: center">
                <img class="user-avatar" src="./images/user.png"/>
                <p class="user-name"></p>
                <div style="display: flex;justify-content: center;align-items: center;width: 150px">
                    <p class="user-id" style="margin:0 10px"></p>
                   
                </div>
            </div>
        <div class="user-detail">
    <div class="xpbar">
        <div class="xpprogress" style="width: 50%"></div>
    </div>
    <div class="xppoints">1 / 100 (50%)</div>
</div>

            <a data-toggle="modal" data-target="#inPageModal" onclick="inPageModal" class="btn btn-info"
               role="button"
               style="width: 80%;margin-top:8px ">Chọn Skin</a>
			   <br>
			  <p style="font-family:'Courier New'">Bạn còn <span class="user-coins"></span> lượt uploads</p>
			   <button  id="btnLogout" onclick="logout()">Logout  </button>

        </div>
    </center>
    <!---->

    <div id="helloDialog">

        <form role="form">
            <div class="form-group">
                <div style="float: left; margin-left: 20px;">
                    <div id="logo">
                        <img class="logo" src="./logo.png">
                    </div>
                </div>
                <br clear="both"/></div>

            <div class="form-group">
                <input id="nick" class="form-control" placeholder="Nick" maxlength="15"/>
                <select id="gamemode" class="form-control" onchange="setGameMode($(this).val());" required>
                    <option selected value="">FFA</option>
                </select>
                <br clear="both"/></div>
            <div id="locationUnknown">
               
            </div>
            <div>
                <div class="text-muted region-message CN-China"></div>
            </div>
            <div class="form-group">
                <button type="submit" id="play-btn"
                        onclick="setNick(document.getElementById('nick').value); return false;"
                        class="btn btn-play btn-success btn-needs-server">Play
                </button>
				
                					<button onclick="$('#settings, #instructions').toggle(); return false;"
                        class="btn btn-info btn-settings" id="settings-btn"><i class="glyphicon glyphicon-cog"></i>
                </button>
				
				<br><br>
                
                <button type="button" id="btnLogin" data-toggle="modal" data-target="#login" role="button"
                        class="btn btn-play btn-primary btn-needs-server">Login️
                </button>
				    

                <br clear="both"/>
								                
            </div>


                <div id="settings" class="checkbox" style="display:none;">
                    <div class="form-group" id="mainform">
                        <button id="spectate-btn" onclick="spectate(); return false;" style="width: 100%" class="btn btn-warning btn-spectate btn-needs-server">Spectate
                        </button>
                        <br clear="both" />
                    </div>
                    <div style="margin: 6px;">
                        <label>
                            <input type="checkbox" class="save" data-box-id="1" onchange="setSkins(!$(this).is(':checked'));"> No skins</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="2" onchange="setNames(!$(this).is(':checked'));"> No names</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="3" onchange="setDarkTheme($(this).is(':checked'));"> Dark Theme</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="4" onchange="setColors($(this).is(':checked'));"> No colors</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));"> Show mass</label>
                        
                            
                        <label>
                            <input type="checkbox" class="save" data-box-id="7" onchange="setChatHide($(this).is(':checked'));"> Hide Chat</label>
                    </div>
                </div>
            </form>

            <div id="instructions">
                <hr/>
                <center>
                    <span class="text-muted">
                        Move your mouse to control your cell<br/>
                        Press <b>Space</b> to split<br/>
                        Press <b>W</b> to eject some mass<br/>
                    </span>
                </center>
            </div>

            <hr />
            <center><div id="footer">
                <a href="https://m.me/darealsh7ne" class="text-muted">SUPPORT</a>
            </div></center>

        </div>
    </div>

    <div id="connecting">
        <div style="width: 350px; background-color: #FFFFFF; margin: 100px auto; border-radius: 15px; padding: 5px 15px 5px 15px;">
            <h2>Connecting</h2>
            <p> If you cannot connect to the servers, check if you have some anti virus or firewall blocking the connection.</p>
        </div>
    </div>
	<input type="hidden" id="skin" class="form-control" placeholder="Skin Name">
<!--chose skin modal-->
	<div class="modal fade" id="inPageModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <ul class="list-skins">
				

                </ul>
                
            </div>

            <div class="modal-footer">
                <a href="./uploads.html">
                    <button type="button" class="btn btn-primary border-0">Upload SKin</button>
                </a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
	</div>

<div style="font-family:'Ubuntu'">&nbsp;</div>


<div class="modal fade" id="login" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>

                <h4 id="inPageModalTitle" class="modal-title">Login </h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_login">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username1" class="form-control"
                               placeholder="Email address or username" required/>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password1" class="form-control"
                               placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign In</button>
                    <hr>
                </form>
                <div class="center">
                    Bạn chưa có tài khoản<a href="javascript:void(0);" data-toggle="modal" data-target="#register">
                    Register Now </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="register" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 id="inPageModalTitle" class="modal-title">Register</h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_register">
                    

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" class="form-control" placeholder="Email address"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username" class="form-control" placeholder="Username"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password" class="form-control" placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-success"></div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign Up</button>
                    <hr/>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <canvas id="canvas" width="800" height="600"></canvas>
    <input type="text" id="chat_textbox" placeholder="Press enter to chat!" maxlength="200" />
    <div style="font-family:'Ubuntu'">&nbsp;</div>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</body>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<script src="/msgpack.js"></script>
<script src="/map.js?1"></script>
<script type="text/javascript">
    //code by khanh
    let user_id = 0;
    Array.from(document.querySelectorAll("font")).forEach((item) => item.style.color = "#000")

    const handleCheckAuthenticate = () => {
        // send a request to check is login?
        // if login success call load user!
        $.ajax({
            method: "POST",
            url: "ajax/check_authenticate.php",
            success: (res) => {
                user_id = JSON.parse(res).user.id
                handleLoadUserInfo(JSON.parse(res).user)
            },
            error: (err) => {
                alert("Opps!Something wrong!")
                //    you can reload page here!
            }
        })
    }




   const handleLoadUserInfo = (user) => {
        //    load data to dialog
        console.log(user);
        let userDialog = document.getElementById("user-info-dialog")
        let username = document.querySelector("#user-info-dialog .user-name")
		

        let id = document.querySelector("#user-info-dialog .user-id")

        let btnLogin = document.getElementById("btnLogin")
     
		    let btnLogout = document.getElementById("btnLogout");

        let coins = document.querySelector(".user-coins")
        let skin = document.querySelector(".user-avatar")
        if (user) {
            if (user.active_image_path) {
                skin.setAttribute("src", user.active_image_path)
            }
            username.textContent = user.username;

            userDialog.style.display = "flex"
            id.textContent = "ID:" + user.id
            btnLogin.style.display = "none"
			btnLogout.style.display = "inline-block"; 
            coins.textContent = "" + user.coins
        } else {
        userDialog.style.display = "none"; // Ẩn hộp thoại thông tin người dùng
        btnLogin.style.display = "inline-block"; // Hiển thị nút đăng nhập
        id.textContent = "";
        btnLogout.style.display = "none"; // Ẩn nút đăng xuất
        }

    }


    handleCheckAuthenticate()
	

    function logout() {
        $.post("logout.php", [], function (data) {
            console.log(data)
            if (data) {
                window.location.assign(window.location.href)
            }
        })
    }

    $(document).ready(function () {


        //    end
        $("#sign-in-link").click(function () {
            $("#sign-up-form-container").hide();
            $("#sign-in-form-container").fadeIn(500);
        });

        $("#sign-up-link").click(function () {
            $("#sign-in-form-container").hide();
            $("#sign-up-form-container").fadeIn(500);
        });

        $("#form_login").submit(function (e) {
            e.preventDefault();
            $.post("ajax/login.php", {formData: $(this).serialize()}, function (data) {
               console.log(data);
                if (data.success === true) {
                    window.location.reload();
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';

                    $("#form_login .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });

        $("#form_register").submit(function (e) {
            e.preventDefault();
            $.post("ajax/register.php", {formData: $(this).serialize()}, function (data) {
                console.log(data);
                if (data.success === true) {
                    $("#form_register .alert-errors").html("").hide();
                    $("#form_register .alert-success").html("Successful registration. Redirecting to dashboard in 3 seconds. Please wait...").fadeIn(1000);
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';
                    $("#form_register .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });
    });

  
    function setskins(a) {
        $('#skin').val(a);
    }

    function confirmSetSkin(path, self) {
         {
            let rel_path = path.slice(8, path.length - 4)
            setskins(rel_path)
            document.querySelectorAll(".list-skins li").forEach((val, index) => {
                if (val.classList.contains("active")) {
                    val.classList.remove("active")
                }
            })

            document.querySelectorAll(".list-skins li img").forEach((val, index) => {
                if (val === self) {
                    if (!val.classList.contains("active")) {
                        val.classList.add("active")
                    }
                }
            })
            $.ajax({
                url: "ajax/update_active_image.php",
                method: "post",
                data: {user_id: user_id, path: path},
                success: (res) => {
                    document.querySelector(".user-avatar").setAttribute("src", path)
                    $("#inPageModal").modal("hide")
                }
            })
        }
    }


    const handleLoadUISkins = (skins) => {
        if (skins) {
            let count = 0
            let htmls = skins.map((val, index) => {
                let active = false;
                if (val.path === val.active_image_path) {
                  //  console.log(val.path,val.active_image_path)
                    active = true;
                    count++;
                }
                return `
                <li  class="set-skin" style="margin: 10px 6px;" onclick="confirmSetSkin('${val.path}',this)">
                        <img src="${val.path}" class="skin-thumbnail ${active ? 'active' : ''}">
                        <span>Còn lại ${val.still_day}ngày</span>
                </li>`;

            }).join(" ")

            htmls += `
            <li
                    </li>`
            document.querySelector(".list-skins").innerHTML = htmls;
        }
    }

    $("#inPageModal").on("show.bs.modal", function () {
        if (user_id > 0) {
            $.ajax({
                url: "ajax/get_skins.php",
                method: "post",
                data: {user_id: user_id},
                success: (res) => {
                   
                    handleLoadUISkins(JSON.parse(res))
                }
            })
        } else {
            alert("Can't load user skins!")
        }
    })
	
	</script>
</html>

```
19. **You**: Check the following code for bugs and provide repair suggestions: 
```html
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Eat cells smaller than you and don't get eaten by the bigger ones, as an MMO">
    <meta name="keywords" content="agario, agar, io, cell, cells, virus, bacteria, blob, game, games, web game, html5, fun, flash">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>999999$</title>

    <link id="favicon" rel="icon" type="image/png" href="assets/img/favicon.png" />
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/index.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="img.css"/>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="assets/js/log.js"></script>
    <script src="assets/js/vector.js"></script>
    <script src="assets/js/main_out.js?7"></script> 
		<link id="teststyle" href=".\style.css?7" rel="stylesheet">
</head>
<style>

    body {
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    .skin-thumbnail{
        border: 2px solid black;
        border-radius: 50%;
    }
    .list-skins {
        width: 100%;
        height: 100%;
        padding: 10px 8px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        flex-wrap: wrap;
    }


    .list-skins li {
        margin: 0 8px;
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
    }
    .list-skins li span{
        margin: 8px 0;
        font-size: 1.2rem;
        letter-spacing: 1.5px;
    }

    .list-skins li .skin-thumbnail.active {
        border: 2px solid rgb(224, 19, 19);
    }

    .list-skins li img {
        border-radius: 50%;
        width: 96px;
        height: 96px;
        cursor: pointer;
        object-fit: cover;
    }

    #canvas {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, .498039);
    }

    .checkbox label {
        margin-right: 10px;
    }

    form {
        margin-bottom: 0px;
    }

    .btn-play,
    .btn-settings,
    .btn-spectate {
        display: block;
        height: 35px;
        background: rgba(0, 0, 0, .2);
    }

    .btn-play {
        width: 85%;
        float: left;
    }
	

    .btn-settings {
        width: 13%;
        float: right;
    }

    .btn-settings font {
        color: black !important;
    }

    .region-message {
        display: none;
        margin-bottom: 12px;
        margin-left: 6px;
        margin-right: 6px;
        text-align: center;
    }

    li {
        color: white;
        /* bullet color */
    }

    li span {
        color: black;
        /* text color */
    }

    #nick,
    #locationKnown #region {
        width: 65%;
        float: left;
        background: rgba(0, 0, 0, .4);
    }

    #locationUnknown #region {
        margin-bottom: 15px;
    }

    #gamemode {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
        font-family: 20px Ubuntu;

    }

    #spectateBtn {
        width: 33%;
        float: right;
        background: rgba(0, 0, 0, .4);
    }
	 #logo {
        border: 0px #000000 solid;
        font-family: Comic Sans MS;
        font-size: 40px;

        animation: rainbow-text 7000454ms linear 0ms infinite normal;
    }

    .user-id {
        font-size: 1.2rem;
        font-weight: 700;
        margin: 2px 0;
    }

    #helloDialog {
        width: 375px;
        background-color: whitesmoke !important;
        margin: 10px auto;
        border-radius: 15px;
        background: rgba(0, 0, 0, .7);
        padding: 5px 15px 5px 15px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin-right: -50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }


    #chat_textbox {
        -webkit-transition: all .5s ease-in-out;
        -moz-transition: all .5s ease-in-out;
        -o-transition: all .5s ease-in-out;
        transition: all .5s ease-in-out;
        position: absolute;
        z-index: 1;
        border-radius: 25px;
        bottom: 10px;
        background: rgba(0, 0, 0, .8);
        border: 0px;
        outline: none;
        color: #000000;
        height: 30px;
        text-indent: 12px;
        left: 10px;
        width: 300px;
        -webkit-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -moz-animation: rainbow-text 6000ms linear 0ms infinite normal;
        -ms-animation: rainbow-text 6000ms linear 0ms infinite normal;
        animation: rainbow-text 6000ms linear 0ms infinite normal;

    }

    #chat_textbox:focus {
        background: rgba(0, 0, 0, .5);

    }

    .user-info-dialog {
        width: 200px;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: absolute;
        top: 53%;
        left: 50%;
        transform: translate(-200%, -68%);
        background: whitesmoke;
        border-radius: 16px;
        padding: 12px;
    }

    .hide-setting-btn {
        transform: translate(-200%, -65%);
    }

    .form-control {
        background: white !important;
        box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.2) !important;
    }

    .user-info-dialog .user-name {
        font-weight: 700;
        margin: 6px 0;
        font-size: 1.2rem;
        opacity: .7;
    }

    .logout {
        cursor: pointer;
        font-size: 1.2rem;
    }

    .logout:hover {
        text-decoration: underline;
    }

    .user-level {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .user-detail {
        margin: 8px 0;
    }

    .user-exp-bar {
        border: 2px solid;
        border-radius: 16px;
        width: 150px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 6px;
        font-weight: 700;
    }

    .user-avatar {
        width: 64px;
        border-radius: 50%;
        object-fit: cover;
        height: 64px;
    }
	.hidden2 {
    visibility:hidden;
	display:block;
	
	overflow-x:hidden;
}

    @-webkit-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text {
        0% {
            color: #FF3399;
        }
        23% {
            color: #FF6633;
        }
        48% {
            color: #FFF802;
        }
        80% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-webkit-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-moz-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-o-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @-ms-keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

    @keyframes rainbow-text1 {
        40% {
            color: #FF3399;
        }
        70% {
            color: #FF6633;
        }
        80% {
            color: #FFF802;
        }
        90% {
            color: #04A396;
        }
        100% {
            color: #3366FF;
        }
    }

</style>
<body>
<div class="debugwindow"><span class="debugmsg" style="display: none;">Test</span></div>
<div id="preloader">
  <div id="status"><img src="load.png" width="300px">Now loading...<br><br><img src="status.gif"></div>
</div>
	<div class="adoverlay">
	<div id="preroll"></div>
	</div>
	<div class="powerupcontainer">
		<div class="powerups">
			<div class="speedboost powerup"><div class="speedamount"></div><div class="keybox speedkey"></div></div>
			<div class="cannonpower powerup"><div class="cannonamount"></div><div class="keybox cannonkey"></div></div>
			<div class="freeze powerup"><div class="freezeamount"></div><div class="keybox freezekey"></div></div>
		</div>	
	</div>
<div id="overlays"
     style="display:none; position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(0,0,0,0.4); z-index: 200;">
    <!--    if login success!-->
    <!--    coded by khanhAxios-->
    <br>
    <center>
        <div class="user-info-dialog" id="user-info-dialog">
            <div style="text-align: center">
                <img class="user-avatar" src="./images/user.png"/>
                <p class="user-name"></p>
                <div style="display: flex;justify-content: center;align-items: center;width: 150px">
                    <p class="user-id" style="margin:0 10px"></p>
                   
                </div>
            </div>
        <div class="user-detail">
    <div class="xpbar">
        <div class="xpprogress" style="width: 50%"></div>
    </div>
    <div class="xppoints">1 / 100 (50%)</div>
</div>

            <a data-toggle="modal" data-target="#inPageModal" onclick="inPageModal" class="btn btn-info"
               role="button"
               style="width: 80%;margin-top:8px ">Chọn Skin</a>
			   <br>
			  <p style="font-family:'Courier New'">Bạn còn <span class="user-coins"></span> lượt uploads</p>
			   <button  id="btnLogout" onclick="logout()">Logout  </button>

        </div>
    </center>
    <!---->

    <div id="helloDialog">

        <form role="form">
            <div class="form-group">
                <div style="float: left; margin-left: 20px;">
                    <div id="logo">
                        <img class="logo" src="./logo.png">
                    </div>
                </div>
                <br clear="both"/></div>

            <div class="form-group">
                <input id="nick" class="form-control" placeholder="Nick" maxlength="15"/>
                <select id="gamemode" class="form-control" onchange="setGameMode($(this).val());" required>
                    <option selected value="">FFA</option>
                </select>
                <br clear="both"/></div>
            <div id="locationUnknown">
               
            </div>
            <div>
                <div class="text-muted region-message CN-China"></div>
            </div>
            <div class="form-group">
                <button type="submit" id="play-btn"
                        onclick="setNick(document.getElementById('nick').value); return false;"
                        class="btn btn-play btn-success btn-needs-server">Play
                </button>
				
                					<button onclick="$('#settings, #instructions').toggle(); return false;"
                        class="btn btn-info btn-settings" id="settings-btn"><i class="glyphicon glyphicon-cog"></i>
                </button>
				
				<br><br>
                
                <button type="button" id="btnLogin" data-toggle="modal" data-target="#login" role="button"
                        class="btn btn-play btn-primary btn-needs-server">Login️
                </button>
				    

                <br clear="both"/>
								                
            </div>


                <div id="settings" class="checkbox" style="display:none;">
                    <div class="form-group" id="mainform">
                        <button id="spectate-btn" onclick="spectate(); return false;" style="width: 100%" class="btn btn-warning btn-spectate btn-needs-server">Spectate
                        </button>
                        <br clear="both" />
                    </div>
                    <div style="margin: 6px;">
                        <label>
                            <input type="checkbox" class="save" data-box-id="1" onchange="setSkins(!$(this).is(':checked'));"> No skins</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="2" onchange="setNames(!$(this).is(':checked'));"> No names</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="3" onchange="setDarkTheme($(this).is(':checked'));"> Dark Theme</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="4" onchange="setColors($(this).is(':checked'));"> No colors</label>
                        <label>
                            <input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));"> Show mass</label>
                        
                            
                        <label>
                            <input type="checkbox" class="save" data-box-id="7" onchange="setChatHide($(this).is(':checked'));"> Hide Chat</label>
                    </div>
                </div>
            </form>

            <div id="instructions">
                <hr/>
                <center>
                    <span class="text-muted">
                        Move your mouse to control your cell<br/>
                        Press <b>Space</b> to split<br/>
                        Press <b>W</b> to eject some mass<br/>
                    </span>
                </center>
            </div>

            <hr />
            <center><div id="footer">
                <a href="https://m.me/darealsh7ne" class="text-muted">SUPPORT</a>
            </div></center>

        </div>
    </div>

    <div id="connecting">
        <div style="width: 350px; background-color: #FFFFFF; margin: 100px auto; border-radius: 15px; padding: 5px 15px 5px 15px;">
            <h2>Connecting</h2>
            <p> If you cannot connect to the servers, check if you have some anti virus or firewall blocking the connection.</p>
        </div>
    </div>
	<input type="hidden" id="skin" class="form-control" placeholder="Skin Name">
<!--chose skin modal-->
	<div class="modal fade" id="inPageModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <ul class="list-skins">
				

                </ul>
                
            </div>

            <div class="modal-footer">
                <a href="./uploads.html">
                    <button type="button" class="btn btn-primary border-0">Upload SKin</button>
                </a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
	</div>

<div style="font-family:'Ubuntu'">&nbsp;</div>


<div class="modal fade" id="login" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>

                <h4 id="inPageModalTitle" class="modal-title">Login </h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_login">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username1" class="form-control"
                               placeholder="Email address or username" required/>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password1" class="form-control"
                               placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign In</button>
                    <hr>
                </form>
                <div class="center">
                    Bạn chưa có tài khoản<a href="javascript:void(0);" data-toggle="modal" data-target="#register">
                    Register Now </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="register" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 id="inPageModalTitle" class="modal-title">Register</h4>
            </div>
            <div id="inPageModalBody" class="modal-body">
                <form id="form_register">
                    

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" class="form-control" placeholder="Email address"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username" class="form-control" placeholder="Username"
                               required/>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password" class="form-control" placeholder="Password"
                               required/>
                    </div>
                    <div class="alert alert-success"></div>
                    <div class="alert alert-danger alert-errors"></div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Sign Up</button>
                    <hr/>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <canvas id="canvas" width="800" height="600"></canvas>
    <input type="text" id="chat_textbox" placeholder="Press enter to chat!" maxlength="200" />
    <div style="font-family:'Ubuntu'">&nbsp;</div>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</body>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<script src="/msgpack.js"></script>
<script src="/map.js?1"></script>
<script type="text/javascript">
    //code by khanh
    let user_id = 0;
    Array.from(document.querySelectorAll("font")).forEach((item) => item.style.color = "#000")

    const handleCheckAuthenticate = () => {
        // send a request to check is login?
        // if login success call load user!
        $.ajax({
            method: "POST",
            url: "ajax/check_authenticate.php",
            success: (res) => {
                user_id = JSON.parse(res).user.id
                handleLoadUserInfo(JSON.parse(res).user)
            },
            error: (err) => {
                alert("Opps!Something wrong!")
                //    you can reload page here!
            }
        })
    }




   const handleLoadUserInfo = (user) => {
        //    load data to dialog
        console.log(user);
        let userDialog = document.getElementById("user-info-dialog")
        let username = document.querySelector("#user-info-dialog .user-name")
		

        let id = document.querySelector("#user-info-dialog .user-id")

        let btnLogin = document.getElementById("btnLogin")
     
		    let btnLogout = document.getElementById("btnLogout");

        let coins = document.querySelector(".user-coins")
        let skin = document.querySelector(".user-avatar")
        if (user) {
            if (user.active_image_path) {
                skin.setAttribute("src", user.active_image_path)
            }
            username.textContent = user.username;

            userDialog.style.display = "flex"
            id.textContent = "ID:" + user.id
            btnLogin.style.display = "none"
			btnLogout.style.display = "inline-block"; 
            coins.textContent = "" + user.coins
        } else {
        userDialog.style.display = "none"; // Ẩn hộp thoại thông tin người dùng
        btnLogin.style.display = "inline-block"; // Hiển thị nút đăng nhập
        id.textContent = "";
        btnLogout.style.display = "none"; // Ẩn nút đăng xuất
        }

    }


    handleCheckAuthenticate()
	

    function logout() {
        $.post("logout.php", [], function (data) {
            console.log(data)
            if (data) {
                window.location.assign(window.location.href)
            }
        })
    }

    $(document).ready(function () {


        //    end
        $("#sign-in-link").click(function () {
            $("#sign-up-form-container").hide();
            $("#sign-in-form-container").fadeIn(500);
        });

        $("#sign-up-link").click(function () {
            $("#sign-in-form-container").hide();
            $("#sign-up-form-container").fadeIn(500);
        });

        $("#form_login").submit(function (e) {
            e.preventDefault();
            $.post("ajax/login.php", {formData: $(this).serialize()}, function (data) {
               console.log(data);
                if (data.success === true) {
                    window.location.reload();
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';

                    $("#form_login .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });

        $("#form_register").submit(function (e) {
            e.preventDefault();
            $.post("ajax/register.php", {formData: $(this).serialize()}, function (data) {
                console.log(data);
                if (data.success === true) {
                    $("#form_register .alert-errors").html("").hide();
                    $("#form_register .alert-success").html("Successful registration. Redirecting to dashboard in 3 seconds. Please wait...").fadeIn(1000);
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                } else {
                    errors_data = '<ul>';
                    for (var i = 0; i < data.errors.length; i++) {
                        errors_data += '<li>' + data.errors[i] + '</li>';
                    }
                    errors_data += '</ul>';
                    $("#form_register .alert-errors").html(errors_data).hide().fadeIn(1000);
                }
            }, 'json');
        });
    });

  
    function setskins(a) {
        $('#skin').val(a);
    }

    function confirmSetSkin(path, self) {
         {
            let rel_path = path.slice(8, path.length - 4)
            setskins(rel_path)
            document.querySelectorAll(".list-skins li").forEach((val, index) => {
                if (val.classList.contains("active")) {
                    val.classList.remove("active")
                }
            })

            document.querySelectorAll(".list-skins li img").forEach((val, index) => {
                if (val === self) {
                    if (!val.classList.contains("active")) {
                        val.classList.add("active")
                    }
                }
            })
            $.ajax({
                url: "ajax/update_active_image.php",
                method: "post",
                data: {user_id: user_id, path: path},
                success: (res) => {
                    document.querySelector(".user-avatar").setAttribute("src", path)
                    $("#inPageModal").modal("hide")
                }
            })
        }
    }


    const handleLoadUISkins = (skins) => {
        if (skins) {
            let count = 0
            let htmls = skins.map((val, index) => {
                let active = false;
                if (val.path === val.active_image_path) {
                  //  console.log(val.path,val.active_image_path)
                    active = true;
                    count++;
                }
                return `
                <li  class="set-skin" style="margin: 10px 6px;" onclick="confirmSetSkin('${val.path}',this)">
                        <img src="${val.path}" class="skin-thumbnail ${active ? 'active' : ''}">
                        <span>Còn lại ${val.still_day}ngày</span>
                </li>`;

            }).join(" ")

            htmls += `
            <li
                    </li>`
            document.querySelector(".list-skins").innerHTML = htmls;
        }
    }

    $("#inPageModal").on("show.bs.modal", function () {
        if (user_id > 0) {
            $.ajax({
                url: "ajax/get_skins.php",
                method: "post",
                data: {user_id: user_id},
                success: (res) => {
                   
                    handleLoadUISkins(JSON.parse(res))
                }
            })
        } else {
            alert("Can't load user skins!")
        }
    })
	
	</script>
</html>

```
20. **You**: tôi muốn xác minh người dùng có sở hữu skin không